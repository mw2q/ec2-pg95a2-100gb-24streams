BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%aquamarine%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2742189311.68531
 ALGERIA                   |   1997 | 4655148332.11423
 ALGERIA                   |   1996 | 4674780401.78562
 ALGERIA                   |   1995 | 4671336952.84298
 ALGERIA                   |   1994 | 4679359026.97294
 ALGERIA                   |   1993 | 4657761055.33687
 ALGERIA                   |   1992 | 4705276643.39798
 ARGENTINA                 |   1998 | 2712250991.63584
 ARGENTINA                 |   1997 |  4648856017.1286
 ARGENTINA                 |   1996 |  4638763061.5173
 ARGENTINA                 |   1995 | 4620874704.90374
 ARGENTINA                 |   1994 | 4659078495.49894
 ARGENTINA                 |   1993 | 4629512546.65452
 ARGENTINA                 |   1992 | 4646804857.33836
 BRAZIL                    |   1998 | 2717127427.61781
 BRAZIL                    |   1997 | 4627550129.41546
 BRAZIL                    |   1996 | 4671354457.33314
 BRAZIL                    |   1995 | 4639892303.92304
 BRAZIL                    |   1994 | 4635973752.42353
 BRAZIL                    |   1993 |  4659795481.7239
 BRAZIL                    |   1992 | 4641409148.90745
 CANADA                    |   1998 |  2748972600.6353
 CANADA                    |   1997 | 4664386234.88397
 CANADA                    |   1996 | 4693470317.38259
 CANADA                    |   1995 | 4685721234.99387
 CANADA                    |   1994 | 4687508734.97518
 CANADA                    |   1993 | 4663093588.99321
 CANADA                    |   1992 | 4681338609.31029
 CHINA                     |   1998 | 2743001003.53382
 CHINA                     |   1997 | 4644050040.46689
 CHINA                     |   1996 |  4683606002.7107
 CHINA                     |   1995 | 4641726840.45976
 CHINA                     |   1994 | 4667621380.23799
 CHINA                     |   1993 | 4666132957.98335
 CHINA                     |   1992 | 4665096233.71272
 EGYPT                     |   1998 | 2734952638.76803
 EGYPT                     |   1997 | 4671343334.34273
 EGYPT                     |   1996 |  4698176644.1065
 EGYPT                     |   1995 |  4659506830.9434
 EGYPT                     |   1994 | 4657685829.83345
 EGYPT                     |   1993 | 4665469371.79455
 EGYPT                     |   1992 | 4687814579.72426
 ETHIOPIA                  |   1998 | 2748009546.46811
 ETHIOPIA                  |   1997 | 4713067679.25811
 ETHIOPIA                  |   1996 | 4732477613.78219
 ETHIOPIA                  |   1995 | 4721369489.28388
 ETHIOPIA                  |   1994 | 4734361148.39769
 ETHIOPIA                  |   1993 | 4708667625.24628
 ETHIOPIA                  |   1992 | 4715042982.92631
 FRANCE                    |   1998 | 2762830384.56745
 FRANCE                    |   1997 | 4680933627.28582
 FRANCE                    |   1996 | 4701362290.78216
 FRANCE                    |   1995 | 4684977681.29388
 FRANCE                    |   1994 | 4671795540.77522
 FRANCE                    |   1993 | 4659055410.55935
 FRANCE                    |   1992 | 4688533153.26356
 GERMANY                   |   1998 | 2730098224.65464
 GERMANY                   |   1997 | 4669419908.15534
 GERMANY                   |   1996 | 4688990853.55333
 GERMANY                   |   1995 | 4677752309.00529
 GERMANY                   |   1994 | 4651835908.44307
 GERMANY                   |   1993 | 4698026472.34849
 GERMANY                   |   1992 | 4709065140.44103
 INDIA                     |   1998 | 2748253241.63059
 INDIA                     |   1997 | 4684491825.85239
 INDIA                     |   1996 | 4668253601.85467
 INDIA                     |   1995 | 4677408507.25406
 INDIA                     |   1994 | 4687060341.22873
 INDIA                     |   1993 | 4692823841.52514
 INDIA                     |   1992 | 4702190543.90172
 INDONESIA                 |   1998 | 2713826403.08206
 INDONESIA                 |   1997 | 4631660205.62058
 INDONESIA                 |   1996 | 4642212583.98705
 INDONESIA                 |   1995 | 4617325512.83914
 INDONESIA                 |   1994 | 4621608630.45013
 INDONESIA                 |   1993 |  4626444600.1891
 INDONESIA                 |   1992 | 4654826746.71791
 IRAN                      |   1998 | 2738524066.31672
 IRAN                      |   1997 | 4672709809.36057
 IRAN                      |   1996 | 4675310905.98996
 IRAN                      |   1995 | 4678125072.84889
 IRAN                      |   1994 | 4677416762.81765
 IRAN                      |   1993 |  4670080608.1863
 IRAN                      |   1992 | 4690325437.05865
 IRAQ                      |   1998 | 2700224247.85429
 IRAQ                      |   1997 | 4636674284.78287
 IRAQ                      |   1996 | 4634510211.78918
 IRAQ                      |   1995 | 4634383956.44764
 IRAQ                      |   1994 | 4631045069.62278
 IRAQ                      |   1993 | 4629381542.83734
 IRAQ                      |   1992 | 4632778819.78044
 JAPAN                     |   1998 | 2741680135.59677
 JAPAN                     |   1997 | 4658971695.75896
 JAPAN                     |   1996 | 4668268533.68793
 JAPAN                     |   1995 | 4637878070.41786
 JAPAN                     |   1994 | 4654381215.82629
 JAPAN                     |   1993 | 4642013253.22217
 JAPAN                     |   1992 | 4647247998.71779
 JORDAN                    |   1998 | 2716656224.82406
 JORDAN                    |   1997 | 4635513286.99798
 JORDAN                    |   1996 | 4686312751.44046
 JORDAN                    |   1995 | 4663912117.52133
 JORDAN                    |   1994 | 4651784362.22841
 JORDAN                    |   1993 | 4639407422.37818
 JORDAN                    |   1992 | 4655102655.57544
 KENYA                     |   1998 | 2728885185.35825
 KENYA                     |   1997 | 4628659762.29224
 KENYA                     |   1996 | 4643162085.63081
 KENYA                     |   1995 | 4628489236.16876
 KENYA                     |   1994 | 4642529375.54419
 KENYA                     |   1993 | 4636163969.30031
 KENYA                     |   1992 | 4653219572.00186
 MOROCCO                   |   1998 | 2746781676.84054
 MOROCCO                   |   1997 | 4675003906.03729
 MOROCCO                   |   1996 | 4700255491.82611
 MOROCCO                   |   1995 | 4680336039.48973
 MOROCCO                   |   1994 |  4687158851.9257
 MOROCCO                   |   1993 | 4683262227.15984
 MOROCCO                   |   1992 | 4693650368.95832
 MOZAMBIQUE                |   1998 | 2729229365.74207
 MOZAMBIQUE                |   1997 |  4663698978.4479
 MOZAMBIQUE                |   1996 | 4657542426.55872
 MOZAMBIQUE                |   1995 | 4643383034.12263
 MOZAMBIQUE                |   1994 | 4657003295.89917
 MOZAMBIQUE                |   1993 | 4629679305.54878
 MOZAMBIQUE                |   1992 | 4675461696.31977
 PERU                      |   1998 | 2705550378.81453
 PERU                      |   1997 | 4634651663.70082
 PERU                      |   1996 | 4613335464.35233
 PERU                      |   1995 | 4616677048.04488
 PERU                      |   1994 | 4610293581.93493
 PERU                      |   1993 | 4620195630.26001
 PERU                      |   1992 | 4658513584.02228
 ROMANIA                   |   1998 |  2759719182.3136
 ROMANIA                   |   1997 | 4667284775.33149
 ROMANIA                   |   1996 | 4734963689.87928
 ROMANIA                   |   1995 | 4686738814.14339
 ROMANIA                   |   1994 |  4686341136.6215
 ROMANIA                   |   1993 | 4682253359.28923
 ROMANIA                   |   1992 | 4715484594.74386
 RUSSIA                    |   1998 |  2733000494.1124
 RUSSIA                    |   1997 | 4693463525.32654
 RUSSIA                    |   1996 | 4671751074.69534
 RUSSIA                    |   1995 | 4657949612.70552
 RUSSIA                    |   1994 | 4645450659.39705
 RUSSIA                    |   1993 | 4661283827.41501
 RUSSIA                    |   1992 | 4668302251.40072
 SAUDI ARABIA              |   1998 | 2722165648.02945
 SAUDI ARABIA              |   1997 | 4639041049.80156
 SAUDI ARABIA              |   1996 |  4666196730.5074
 SAUDI ARABIA              |   1995 | 4639659776.98953
 SAUDI ARABIA              |   1994 | 4648245512.36927
 SAUDI ARABIA              |   1993 | 4652402581.67482
 SAUDI ARABIA              |   1992 |  4658678230.2051
 UNITED KINGDOM            |   1998 |  2774347665.6379
 UNITED KINGDOM            |   1997 | 4717803166.97116
 UNITED KINGDOM            |   1996 |  4725626317.9014
 UNITED KINGDOM            |   1995 | 4698160562.28478
 UNITED KINGDOM            |   1994 |  4708407654.7206
 UNITED KINGDOM            |   1993 | 4722737043.52953
 UNITED KINGDOM            |   1992 | 4726176744.86838
 UNITED STATES             |   1998 |  2750032153.1866
 UNITED STATES             |   1997 | 4692460064.65455
 UNITED STATES             |   1996 |  4698373373.2732
 UNITED STATES             |   1995 | 4676423887.51063
 UNITED STATES             |   1994 | 4658054076.40856
 UNITED STATES             |   1993 | 4661532653.32276
 UNITED STATES             |   1992 |  4681078268.2503
 VIETNAM                   |   1998 | 2728403064.58778
 VIETNAM                   |   1997 | 4662268127.77058
 VIETNAM                   |   1996 | 4685493942.48267
 VIETNAM                   |   1995 | 4670058138.20404
 VIETNAM                   |   1994 |  4659741424.1858
 VIETNAM                   |   1993 | 4686119345.06105
 VIETNAM                   |   1992 |  4668094728.2951
(175 rows)

COMMIT;
COMMIT
