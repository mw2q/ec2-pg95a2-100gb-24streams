BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%magenta%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2745546962.11143
 ALGERIA                   |   1997 | 4661378554.50893
 ALGERIA                   |   1996 | 4673240025.03843
 ALGERIA                   |   1995 | 4674715145.10342
 ALGERIA                   |   1994 | 4665365896.69977
 ALGERIA                   |   1993 | 4677937250.59379
 ALGERIA                   |   1992 | 4682118017.55824
 ARGENTINA                 |   1998 | 2714395202.32563
 ARGENTINA                 |   1997 | 4674669376.00312
 ARGENTINA                 |   1996 | 4656707696.20038
 ARGENTINA                 |   1995 | 4642455441.87183
 ARGENTINA                 |   1994 | 4647528675.96229
 ARGENTINA                 |   1993 | 4657968293.13534
 ARGENTINA                 |   1992 |   4650508402.464
 BRAZIL                    |   1998 | 2739486777.82533
 BRAZIL                    |   1997 |  4655430941.8285
 BRAZIL                    |   1996 | 4654498359.39247
 BRAZIL                    |   1995 | 4641293011.06514
 BRAZIL                    |   1994 | 4643063900.84474
 BRAZIL                    |   1993 | 4637232810.03816
 BRAZIL                    |   1992 | 4665753407.77634
 CANADA                    |   1998 | 2741267859.78968
 CANADA                    |   1997 | 4678854135.63383
 CANADA                    |   1996 | 4700400509.71905
 CANADA                    |   1995 |   4696414810.617
 CANADA                    |   1994 | 4655222950.22195
 CANADA                    |   1993 | 4688633419.59758
 CANADA                    |   1992 | 4694613058.12034
 CHINA                     |   1998 |  2739420737.1031
 CHINA                     |   1997 | 4673325353.92877
 CHINA                     |   1996 | 4681843087.21374
 CHINA                     |   1995 |   4658474611.798
 CHINA                     |   1994 | 4685488560.96461
 CHINA                     |   1993 | 4660656138.66127
 CHINA                     |   1992 | 4659017111.13692
 EGYPT                     |   1998 | 2735897957.40503
 EGYPT                     |   1997 | 4670686620.93578
 EGYPT                     |   1996 | 4688728480.28125
 EGYPT                     |   1995 | 4670855880.91957
 EGYPT                     |   1994 | 4666105545.60092
 EGYPT                     |   1993 | 4679808454.48719
 EGYPT                     |   1992 | 4662674960.19095
 ETHIOPIA                  |   1998 | 2750608905.99048
 ETHIOPIA                  |   1997 | 4687820589.86736
 ETHIOPIA                  |   1996 | 4693840102.62688
 ETHIOPIA                  |   1995 |  4700984623.5699
 ETHIOPIA                  |   1994 | 4666260682.39143
 ETHIOPIA                  |   1993 |  4685724993.3571
 ETHIOPIA                  |   1992 | 4692025724.71576
 FRANCE                    |   1998 | 2754007881.93694
 FRANCE                    |   1997 | 4694874116.35535
 FRANCE                    |   1996 | 4711206837.70903
 FRANCE                    |   1995 | 4713213396.43441
 FRANCE                    |   1994 | 4701856202.90661
 FRANCE                    |   1993 | 4723118363.08154
 FRANCE                    |   1992 | 4687967744.32917
 GERMANY                   |   1998 | 2749379683.05384
 GERMANY                   |   1997 | 4682988153.78647
 GERMANY                   |   1996 | 4691570981.07332
 GERMANY                   |   1995 | 4692877468.56021
 GERMANY                   |   1994 | 4697301882.60556
 GERMANY                   |   1993 | 4698959236.57986
 GERMANY                   |   1992 | 4701224731.05333
 INDIA                     |   1998 | 2745083135.32022
 INDIA                     |   1997 | 4656727316.97468
 INDIA                     |   1996 | 4668125715.12618
 INDIA                     |   1995 |  4668892751.1417
 INDIA                     |   1994 |  4661927223.3484
 INDIA                     |   1993 | 4689090664.53176
 INDIA                     |   1992 | 4669201459.33496
 INDONESIA                 |   1998 | 2736161022.39582
 INDONESIA                 |   1997 | 4642615004.47788
 INDONESIA                 |   1996 | 4650897624.22909
 INDONESIA                 |   1995 | 4657087930.43031
 INDONESIA                 |   1994 | 4650797817.85316
 INDONESIA                 |   1993 | 4625482680.98632
 INDONESIA                 |   1992 | 4658012819.76311
 IRAN                      |   1998 | 2705218249.44694
 IRAN                      |   1997 | 4617883674.47267
 IRAN                      |   1996 |  4639502610.5427
 IRAN                      |   1995 | 4624674629.82924
 IRAN                      |   1994 |   4640675883.748
 IRAN                      |   1993 | 4646242828.42546
 IRAN                      |   1992 | 4646228233.54087
 IRAQ                      |   1998 | 2730059649.19329
 IRAQ                      |   1997 | 4654346100.22472
 IRAQ                      |   1996 | 4656127363.08386
 IRAQ                      |   1995 | 4614271340.13447
 IRAQ                      |   1994 | 4656764178.57138
 IRAQ                      |   1993 |  4662528157.1909
 IRAQ                      |   1992 | 4650653876.22674
 JAPAN                     |   1998 | 2705256480.24386
 JAPAN                     |   1997 | 4606952032.81748
 JAPAN                     |   1996 | 4644941657.17442
 JAPAN                     |   1995 | 4642177821.71129
 JAPAN                     |   1994 | 4617402033.00625
 JAPAN                     |   1993 |  4626746474.2642
 JAPAN                     |   1992 | 4649600740.04094
 JORDAN                    |   1998 | 2733385941.93407
 JORDAN                    |   1997 | 4684877572.21632
 JORDAN                    |   1996 | 4678507028.12862
 JORDAN                    |   1995 | 4658434363.85587
 JORDAN                    |   1994 | 4667851927.77122
 JORDAN                    |   1993 | 4658423758.42315
 JORDAN                    |   1992 | 4681435554.86899
 KENYA                     |   1998 | 2722941468.87528
 KENYA                     |   1997 | 4637013431.96829
 KENYA                     |   1996 | 4651397197.27447
 KENYA                     |   1995 | 4629675673.15075
 KENYA                     |   1994 | 4648712951.08632
 KENYA                     |   1993 | 4646976151.22084
 KENYA                     |   1992 | 4647933197.71809
 MOROCCO                   |   1998 | 2755293026.47834
 MOROCCO                   |   1997 | 4679793513.68099
 MOROCCO                   |   1996 | 4682734989.46245
 MOROCCO                   |   1995 | 4683693139.81544
 MOROCCO                   |   1994 | 4655760616.24142
 MOROCCO                   |   1993 | 4660815675.20851
 MOROCCO                   |   1992 | 4674159195.21927
 MOZAMBIQUE                |   1998 | 2717880051.07099
 MOZAMBIQUE                |   1997 |  4646101785.8974
 MOZAMBIQUE                |   1996 | 4688797374.14036
 MOZAMBIQUE                |   1995 | 4660897874.02297
 MOZAMBIQUE                |   1994 | 4651166429.85331
 MOZAMBIQUE                |   1993 |   4675095273.567
 MOZAMBIQUE                |   1992 | 4649380062.95682
 PERU                      |   1998 | 2718580590.34764
 PERU                      |   1997 | 4610205035.00633
 PERU                      |   1996 | 4639975178.78591
 PERU                      |   1995 | 4615328223.61457
 PERU                      |   1994 | 4619815486.60526
 PERU                      |   1993 | 4594610380.21306
 PERU                      |   1992 | 4623811171.51999
 ROMANIA                   |   1998 | 2734657840.89418
 ROMANIA                   |   1997 | 4645337540.41062
 ROMANIA                   |   1996 | 4685448359.34483
 ROMANIA                   |   1995 | 4650542827.63913
 ROMANIA                   |   1994 | 4671063389.85583
 ROMANIA                   |   1993 | 4687266368.40034
 ROMANIA                   |   1992 | 4679546993.32165
 RUSSIA                    |   1998 | 2717761713.81565
 RUSSIA                    |   1997 | 4674204972.83251
 RUSSIA                    |   1996 | 4678136327.00105
 RUSSIA                    |   1995 | 4643240220.94382
 RUSSIA                    |   1994 |  4647447280.6626
 RUSSIA                    |   1993 | 4685377279.67231
 RUSSIA                    |   1992 |  4670930696.7511
 SAUDI ARABIA              |   1998 | 2731936904.26625
 SAUDI ARABIA              |   1997 | 4614307105.54449
 SAUDI ARABIA              |   1996 | 4638144519.64411
 SAUDI ARABIA              |   1995 | 4631259054.10782
 SAUDI ARABIA              |   1994 | 4608237749.18497
 SAUDI ARABIA              |   1993 | 4624655645.97725
 SAUDI ARABIA              |   1992 | 4627918638.43354
 UNITED KINGDOM            |   1998 |   2751918952.145
 UNITED KINGDOM            |   1997 | 4709567020.59207
 UNITED KINGDOM            |   1996 | 4711425977.68489
 UNITED KINGDOM            |   1995 | 4678702675.45662
 UNITED KINGDOM            |   1994 | 4676228634.52847
 UNITED KINGDOM            |   1993 | 4700470460.51781
 UNITED KINGDOM            |   1992 | 4702998377.77055
 UNITED STATES             |   1998 |  2740094813.4597
 UNITED STATES             |   1997 | 4664603178.55743
 UNITED STATES             |   1996 | 4710480587.34343
 UNITED STATES             |   1995 | 4667331629.85406
 UNITED STATES             |   1994 | 4665996467.54401
 UNITED STATES             |   1993 |  4679367015.3004
 UNITED STATES             |   1992 | 4666189526.70997
 VIETNAM                   |   1998 | 2735036356.53474
 VIETNAM                   |   1997 | 4680452023.10852
 VIETNAM                   |   1996 |  4679094316.9814
 VIETNAM                   |   1995 | 4700068076.87471
 VIETNAM                   |   1994 | 4654298778.34154
 VIETNAM                   |   1993 | 4672626940.19818
 VIETNAM                   |   1992 | 4700244883.62195
(175 rows)

COMMIT;
COMMIT
