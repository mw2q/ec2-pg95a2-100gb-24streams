BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%plum%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2740451156.39527
 ALGERIA                   |   1997 | 4653613093.11812
 ALGERIA                   |   1996 | 4688725440.40875
 ALGERIA                   |   1995 | 4685784166.76843
 ALGERIA                   |   1994 | 4672839908.09311
 ALGERIA                   |   1993 | 4664797823.38685
 ALGERIA                   |   1992 | 4687909051.76145
 ARGENTINA                 |   1998 | 2716435970.76855
 ARGENTINA                 |   1997 | 4636891471.53458
 ARGENTINA                 |   1996 | 4659673278.98653
 ARGENTINA                 |   1995 | 4638498083.43117
 ARGENTINA                 |   1994 | 4642529809.81109
 ARGENTINA                 |   1993 | 4647265722.96409
 ARGENTINA                 |   1992 | 4633917108.71525
 BRAZIL                    |   1998 | 2759210986.68186
 BRAZIL                    |   1997 |  4700161526.7102
 BRAZIL                    |   1996 | 4697111153.92491
 BRAZIL                    |   1995 | 4703133107.18055
 BRAZIL                    |   1994 | 4699551808.50778
 BRAZIL                    |   1993 | 4703306559.94774
 BRAZIL                    |   1992 | 4714023678.25616
 CANADA                    |   1998 | 2740504538.91199
 CANADA                    |   1997 | 4682057480.82636
 CANADA                    |   1996 | 4707952739.99577
 CANADA                    |   1995 | 4675311369.68227
 CANADA                    |   1994 | 4711578187.59126
 CANADA                    |   1993 | 4683710597.93505
 CANADA                    |   1992 | 4676900842.83405
 CHINA                     |   1998 | 2731337672.36514
 CHINA                     |   1997 | 4664824971.32706
 CHINA                     |   1996 | 4693847865.69664
 CHINA                     |   1995 | 4653484561.35781
 CHINA                     |   1994 | 4668119419.06417
 CHINA                     |   1993 | 4634850777.85598
 CHINA                     |   1992 | 4656677508.32737
 EGYPT                     |   1998 | 2737182966.57514
 EGYPT                     |   1997 | 4680210383.66904
 EGYPT                     |   1996 |  4685625767.5013
 EGYPT                     |   1995 | 4665535989.22484
 EGYPT                     |   1994 | 4659822362.13093
 EGYPT                     |   1993 | 4661973492.41496
 EGYPT                     |   1992 | 4684436865.65899
 ETHIOPIA                  |   1998 | 2788260598.54712
 ETHIOPIA                  |   1997 | 4718405717.09593
 ETHIOPIA                  |   1996 | 4728041425.20828
 ETHIOPIA                  |   1995 | 4734127092.97924
 ETHIOPIA                  |   1994 | 4724290910.02092
 ETHIOPIA                  |   1993 | 4726464278.58446
 ETHIOPIA                  |   1992 | 4724740629.65305
 FRANCE                    |   1998 | 2734400496.70032
 FRANCE                    |   1997 | 4692947107.81493
 FRANCE                    |   1996 | 4686020769.73099
 FRANCE                    |   1995 | 4674983839.29527
 FRANCE                    |   1994 |  4684038342.1834
 FRANCE                    |   1993 |  4690966179.0906
 FRANCE                    |   1992 | 4692907352.37838
 GERMANY                   |   1998 | 2745399558.42922
 GERMANY                   |   1997 | 4705106033.58004
 GERMANY                   |   1996 | 4697730078.09048
 GERMANY                   |   1995 | 4648530592.53436
 GERMANY                   |   1994 | 4695267710.94222
 GERMANY                   |   1993 | 4679076714.82371
 GERMANY                   |   1992 | 4698052255.91854
 INDIA                     |   1998 | 2762510711.98598
 INDIA                     |   1997 | 4686807931.72472
 INDIA                     |   1996 |   4673960203.951
 INDIA                     |   1995 | 4645190835.68248
 INDIA                     |   1994 | 4638140469.35316
 INDIA                     |   1993 | 4662070420.68609
 INDIA                     |   1992 | 4689832038.07837
 INDONESIA                 |   1998 | 2728541873.39264
 INDONESIA                 |   1997 | 4626473996.43868
 INDONESIA                 |   1996 |  4640532994.4872
 INDONESIA                 |   1995 |  4625938905.0745
 INDONESIA                 |   1994 | 4618968915.30234
 INDONESIA                 |   1993 | 4623195124.11173
 INDONESIA                 |   1992 | 4631959693.12255
 IRAN                      |   1998 | 2736417351.48182
 IRAN                      |   1997 | 4643225438.58391
 IRAN                      |   1996 | 4671702131.67692
 IRAN                      |   1995 | 4651582588.75076
 IRAN                      |   1994 | 4650313066.04037
 IRAN                      |   1993 | 4655421275.89496
 IRAN                      |   1992 | 4651118208.96546
 IRAQ                      |   1998 | 2742458060.63021
 IRAQ                      |   1997 | 4679896382.29024
 IRAQ                      |   1996 | 4697378382.60412
 IRAQ                      |   1995 | 4670690428.14168
 IRAQ                      |   1994 | 4663536930.72892
 IRAQ                      |   1993 |  4675051410.6685
 IRAQ                      |   1992 | 4676184896.57888
 JAPAN                     |   1998 | 2717264658.81258
 JAPAN                     |   1997 | 4662726135.47261
 JAPAN                     |   1996 | 4651451544.25588
 JAPAN                     |   1995 | 4653004215.76913
 JAPAN                     |   1994 | 4663343705.91917
 JAPAN                     |   1993 | 4646438349.50516
 JAPAN                     |   1992 | 4653958604.43947
 JORDAN                    |   1998 | 2744314417.99971
 JORDAN                    |   1997 | 4682708576.51631
 JORDAN                    |   1996 | 4706320752.75772
 JORDAN                    |   1995 | 4675436501.50217
 JORDAN                    |   1994 | 4683127692.48537
 JORDAN                    |   1993 | 4670377638.96197
 JORDAN                    |   1992 | 4669150587.65451
 KENYA                     |   1998 | 2714634808.42178
 KENYA                     |   1997 | 4599005710.74898
 KENYA                     |   1996 |  4643370725.9524
 KENYA                     |   1995 | 4614352596.19052
 KENYA                     |   1994 | 4635838754.03698
 KENYA                     |   1993 | 4610924677.73193
 KENYA                     |   1992 | 4634734908.03086
 MOROCCO                   |   1998 | 2732493154.59134
 MOROCCO                   |   1997 | 4669566277.26584
 MOROCCO                   |   1996 | 4705308068.84171
 MOROCCO                   |   1995 | 4695569813.20917
 MOROCCO                   |   1994 | 4680198315.65855
 MOROCCO                   |   1993 | 4653486208.87934
 MOROCCO                   |   1992 | 4705307915.97777
 MOZAMBIQUE                |   1998 | 2755570166.50029
 MOZAMBIQUE                |   1997 | 4682071038.27406
 MOZAMBIQUE                |   1996 | 4703637533.61168
 MOZAMBIQUE                |   1995 | 4673938278.43417
 MOZAMBIQUE                |   1994 | 4687198102.65668
 MOZAMBIQUE                |   1993 | 4675062505.51979
 MOZAMBIQUE                |   1992 | 4700995546.67081
 PERU                      |   1998 | 2729918516.86859
 PERU                      |   1997 | 4655829308.48745
 PERU                      |   1996 | 4646982761.88276
 PERU                      |   1995 | 4622291697.30694
 PERU                      |   1994 | 4639313568.77633
 PERU                      |   1993 |  4660339649.9414
 PERU                      |   1992 | 4679216905.91305
 ROMANIA                   |   1998 | 2769373075.17177
 ROMANIA                   |   1997 | 4674125653.48717
 ROMANIA                   |   1996 | 4724061508.80121
 ROMANIA                   |   1995 | 4677949874.80428
 ROMANIA                   |   1994 | 4679706836.18452
 ROMANIA                   |   1993 |  4698798157.5981
 ROMANIA                   |   1992 | 4678452588.25779
 RUSSIA                    |   1998 | 2731570755.65704
 RUSSIA                    |   1997 | 4675285180.46189
 RUSSIA                    |   1996 | 4683856278.99276
 RUSSIA                    |   1995 | 4680189923.93425
 RUSSIA                    |   1994 | 4667168122.59576
 RUSSIA                    |   1993 | 4700897731.88344
 RUSSIA                    |   1992 | 4686991572.27241
 SAUDI ARABIA              |   1998 |  2734156530.8224
 SAUDI ARABIA              |   1997 | 4648579585.59642
 SAUDI ARABIA              |   1996 | 4650943161.18822
 SAUDI ARABIA              |   1995 | 4659166517.02926
 SAUDI ARABIA              |   1994 | 4669942961.18793
 SAUDI ARABIA              |   1993 | 4637112980.97072
 SAUDI ARABIA              |   1992 | 4657078496.40458
 UNITED KINGDOM            |   1998 | 2757300133.74534
 UNITED KINGDOM            |   1997 | 4695733072.22905
 UNITED KINGDOM            |   1996 | 4700994210.66782
 UNITED KINGDOM            |   1995 | 4693574368.22164
 UNITED KINGDOM            |   1994 | 4693848607.23952
 UNITED KINGDOM            |   1993 | 4712965120.65614
 UNITED KINGDOM            |   1992 | 4713815639.21156
 UNITED STATES             |   1998 | 2754933142.82133
 UNITED STATES             |   1997 | 4683455715.99389
 UNITED STATES             |   1996 | 4694078625.79342
 UNITED STATES             |   1995 | 4681106949.67298
 UNITED STATES             |   1994 | 4695126789.64299
 UNITED STATES             |   1993 | 4689969699.06945
 UNITED STATES             |   1992 | 4722253510.57364
 VIETNAM                   |   1998 | 2736687608.78778
 VIETNAM                   |   1997 | 4716989243.91132
 VIETNAM                   |   1996 | 4699781153.78223
 VIETNAM                   |   1995 | 4680259333.19129
 VIETNAM                   |   1994 | 4711933994.22361
 VIETNAM                   |   1993 | 4706991860.44268
 VIETNAM                   |   1992 | 4698434537.58325
(175 rows)

COMMIT;
COMMIT
