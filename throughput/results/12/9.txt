BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%dark%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2747027727.46937
 ALGERIA                   |   1997 |  4667638712.1186
 ALGERIA                   |   1996 | 4694983467.14346
 ALGERIA                   |   1995 | 4666482391.54701
 ALGERIA                   |   1994 | 4664705251.57579
 ALGERIA                   |   1993 | 4641650885.18028
 ALGERIA                   |   1992 | 4679530812.65716
 ARGENTINA                 |   1998 | 2727836766.21318
 ARGENTINA                 |   1997 | 4667431535.64177
 ARGENTINA                 |   1996 | 4679460095.79697
 ARGENTINA                 |   1995 | 4650503949.50801
 ARGENTINA                 |   1994 | 4652050284.05096
 ARGENTINA                 |   1993 | 4642206353.30954
 ARGENTINA                 |   1992 | 4668594761.22739
 BRAZIL                    |   1998 | 2711589195.81083
 BRAZIL                    |   1997 | 4681787129.44342
 BRAZIL                    |   1996 | 4680604797.33082
 BRAZIL                    |   1995 | 4666639860.40716
 BRAZIL                    |   1994 | 4677828693.79209
 BRAZIL                    |   1993 | 4676601375.69278
 BRAZIL                    |   1992 | 4660864056.86464
 CANADA                    |   1998 | 2740891234.35445
 CANADA                    |   1997 | 4695103051.15503
 CANADA                    |   1996 | 4690237344.80933
 CANADA                    |   1995 | 4689640383.10516
 CANADA                    |   1994 | 4688372335.63869
 CANADA                    |   1993 | 4658810890.35764
 CANADA                    |   1992 |   4697183319.209
 CHINA                     |   1998 | 2746609751.00491
 CHINA                     |   1997 | 4673949576.87867
 CHINA                     |   1996 | 4684162432.53526
 CHINA                     |   1995 | 4668676657.46977
 CHINA                     |   1994 | 4655092339.80033
 CHINA                     |   1993 | 4668589130.53532
 CHINA                     |   1992 | 4680442278.28231
 EGYPT                     |   1998 | 2738950250.84858
 EGYPT                     |   1997 | 4663587084.60011
 EGYPT                     |   1996 | 4671510712.08868
 EGYPT                     |   1995 | 4668609066.41422
 EGYPT                     |   1994 | 4644629954.43148
 EGYPT                     |   1993 | 4682220173.67924
 EGYPT                     |   1992 | 4704163895.35029
 ETHIOPIA                  |   1998 |  2761249370.4856
 ETHIOPIA                  |   1997 | 4703095696.41038
 ETHIOPIA                  |   1996 | 4719215827.98151
 ETHIOPIA                  |   1995 | 4699620859.08941
 ETHIOPIA                  |   1994 |  4713303606.0505
 ETHIOPIA                  |   1993 | 4716575551.19266
 ETHIOPIA                  |   1992 |  4726275582.7599
 FRANCE                    |   1998 | 2730874799.62465
 FRANCE                    |   1997 | 4715099951.08703
 FRANCE                    |   1996 | 4698030996.18295
 FRANCE                    |   1995 | 4653390196.08389
 FRANCE                    |   1994 | 4685543491.37621
 FRANCE                    |   1993 | 4672639062.62585
 FRANCE                    |   1992 | 4687901269.45304
 GERMANY                   |   1998 |  2746380841.4386
 GERMANY                   |   1997 | 4680416455.72551
 GERMANY                   |   1996 | 4696305057.57482
 GERMANY                   |   1995 | 4680309034.06167
 GERMANY                   |   1994 | 4691758704.52329
 GERMANY                   |   1993 | 4680015208.04294
 GERMANY                   |   1992 | 4693788909.75909
 INDIA                     |   1998 | 2750569021.24648
 INDIA                     |   1997 | 4697921669.84129
 INDIA                     |   1996 | 4729745213.01152
 INDIA                     |   1995 | 4710408604.50064
 INDIA                     |   1994 | 4708144958.86448
 INDIA                     |   1993 | 4708616918.09991
 INDIA                     |   1992 | 4715623746.28893
 INDONESIA                 |   1998 | 2724387303.30657
 INDONESIA                 |   1997 | 4614120647.60396
 INDONESIA                 |   1996 | 4636737121.45584
 INDONESIA                 |   1995 | 4630386804.06815
 INDONESIA                 |   1994 | 4634365396.48567
 INDONESIA                 |   1993 | 4633609861.50993
 INDONESIA                 |   1992 | 4634249727.37542
 IRAN                      |   1998 | 2707087249.48132
 IRAN                      |   1997 | 4626863903.41522
 IRAN                      |   1996 | 4628005775.86042
 IRAN                      |   1995 | 4635145589.36916
 IRAN                      |   1994 |  4611178515.3856
 IRAN                      |   1993 | 4604120598.05593
 IRAN                      |   1992 | 4634114117.54102
 IRAQ                      |   1998 | 2720933701.42079
 IRAQ                      |   1997 | 4632313373.11088
 IRAQ                      |   1996 | 4643362212.13786
 IRAQ                      |   1995 |  4632900198.4193
 IRAQ                      |   1994 |  4656500507.2721
 IRAQ                      |   1993 | 4635068554.12768
 IRAQ                      |   1992 | 4650616879.32752
 JAPAN                     |   1998 | 2714091325.74721
 JAPAN                     |   1997 | 4646329329.05444
 JAPAN                     |   1996 | 4656869936.05989
 JAPAN                     |   1995 |  4619390394.9539
 JAPAN                     |   1994 | 4660665043.64837
 JAPAN                     |   1993 | 4604477247.40065
 JAPAN                     |   1992 | 4643478060.77121
 JORDAN                    |   1998 | 2717165759.91037
 JORDAN                    |   1997 | 4639303799.21475
 JORDAN                    |   1996 | 4656777263.05456
 JORDAN                    |   1995 |  4647478600.3977
 JORDAN                    |   1994 | 4635756856.14829
 JORDAN                    |   1993 |   4666102214.998
 JORDAN                    |   1992 |  4665568071.6906
 KENYA                     |   1998 | 2726182938.04038
 KENYA                     |   1997 | 4610375404.75279
 KENYA                     |   1996 | 4639695560.26996
 KENYA                     |   1995 | 4614923925.20721
 KENYA                     |   1994 | 4592779922.61076
 KENYA                     |   1993 |  4618778364.0411
 KENYA                     |   1992 | 4618550568.95256
 MOROCCO                   |   1998 | 2761230673.52671
 MOROCCO                   |   1997 | 4716655840.25794
 MOROCCO                   |   1996 | 4701519042.16184
 MOROCCO                   |   1995 | 4730464258.80747
 MOROCCO                   |   1994 | 4688783362.73526
 MOROCCO                   |   1993 | 4711762894.64301
 MOROCCO                   |   1992 | 4733370124.12968
 MOZAMBIQUE                |   1998 |   2738668817.389
 MOZAMBIQUE                |   1997 |  4672234367.5694
 MOZAMBIQUE                |   1996 | 4672674322.32104
 MOZAMBIQUE                |   1995 |  4677349395.5571
 MOZAMBIQUE                |   1994 | 4680831896.02355
 MOZAMBIQUE                |   1993 | 4665723884.35638
 MOZAMBIQUE                |   1992 | 4680254150.62063
 PERU                      |   1998 | 2706320819.99252
 PERU                      |   1997 | 4632402770.29108
 PERU                      |   1996 |  4635915175.1552
 PERU                      |   1995 | 4631993053.20744
 PERU                      |   1994 | 4636845129.30809
 PERU                      |   1993 | 4640339323.70467
 PERU                      |   1992 | 4637928034.09292
 ROMANIA                   |   1998 |  2719994632.3955
 ROMANIA                   |   1997 | 4667803427.06369
 ROMANIA                   |   1996 | 4677433846.47143
 ROMANIA                   |   1995 | 4667405441.89373
 ROMANIA                   |   1994 | 4660737321.13841
 ROMANIA                   |   1993 | 4677928332.79057
 ROMANIA                   |   1992 | 4674923086.73759
 RUSSIA                    |   1998 | 2723597436.62085
 RUSSIA                    |   1997 | 4679964777.51975
 RUSSIA                    |   1996 | 4672768414.31272
 RUSSIA                    |   1995 | 4637563310.89623
 RUSSIA                    |   1994 | 4642881554.10302
 RUSSIA                    |   1993 | 4652964836.71535
 RUSSIA                    |   1992 |  4667784591.5442
 SAUDI ARABIA              |   1998 | 2729198133.77462
 SAUDI ARABIA              |   1997 | 4635912257.41339
 SAUDI ARABIA              |   1996 | 4694893725.53789
 SAUDI ARABIA              |   1995 | 4667389553.79775
 SAUDI ARABIA              |   1994 | 4674886561.98512
 SAUDI ARABIA              |   1993 | 4662914230.98128
 SAUDI ARABIA              |   1992 | 4670939336.13052
 UNITED KINGDOM            |   1998 | 2764967404.74554
 UNITED KINGDOM            |   1997 | 4718626689.46186
 UNITED KINGDOM            |   1996 | 4723624436.09265
 UNITED KINGDOM            |   1995 | 4710348593.95172
 UNITED KINGDOM            |   1994 | 4698163189.34221
 UNITED KINGDOM            |   1993 | 4710727892.33377
 UNITED KINGDOM            |   1992 | 4684851351.41157
 UNITED STATES             |   1998 | 2748928577.30784
 UNITED STATES             |   1997 | 4677967698.14667
 UNITED STATES             |   1996 | 4689871292.37755
 UNITED STATES             |   1995 | 4693058158.95037
 UNITED STATES             |   1994 |   4683450053.253
 UNITED STATES             |   1993 | 4690161672.91508
 UNITED STATES             |   1992 | 4700723533.98028
 VIETNAM                   |   1998 | 2755335989.46757
 VIETNAM                   |   1997 |   4683364507.191
 VIETNAM                   |   1996 | 4672202939.58111
 VIETNAM                   |   1995 | 4698937167.71177
 VIETNAM                   |   1994 | 4694971408.96649
 VIETNAM                   |   1993 | 4666480881.64876
 VIETNAM                   |   1992 | 4678369503.09658
(175 rows)

COMMIT;
COMMIT
