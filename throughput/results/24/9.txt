BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%lavender%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2749391744.03687
 ALGERIA                   |   1997 | 4679410267.32323
 ALGERIA                   |   1996 | 4691407536.24429
 ALGERIA                   |   1995 | 4688768662.92118
 ALGERIA                   |   1994 | 4685941937.84725
 ALGERIA                   |   1993 | 4680719329.55903
 ALGERIA                   |   1992 | 4687474540.84377
 ARGENTINA                 |   1998 | 2717079944.66762
 ARGENTINA                 |   1997 | 4644384290.31737
 ARGENTINA                 |   1996 | 4667240282.51684
 ARGENTINA                 |   1995 | 4620206136.89116
 ARGENTINA                 |   1994 | 4649667068.08187
 ARGENTINA                 |   1993 | 4628834285.98021
 ARGENTINA                 |   1992 | 4628602959.43483
 BRAZIL                    |   1998 | 2740004542.92558
 BRAZIL                    |   1997 | 4685837608.85454
 BRAZIL                    |   1996 | 4691665933.37949
 BRAZIL                    |   1995 | 4660930473.09165
 BRAZIL                    |   1994 | 4658219480.88889
 BRAZIL                    |   1993 | 4679221060.30568
 BRAZIL                    |   1992 | 4680333338.31708
 CANADA                    |   1998 | 2741037338.35841
 CANADA                    |   1997 | 4671246625.21428
 CANADA                    |   1996 | 4697061179.01293
 CANADA                    |   1995 | 4700618409.31072
 CANADA                    |   1994 | 4673800820.39505
 CANADA                    |   1993 | 4674061978.90532
 CANADA                    |   1992 |  4678319951.5198
 CHINA                     |   1998 | 2728642621.53111
 CHINA                     |   1997 | 4654256899.15845
 CHINA                     |   1996 | 4683749468.36091
 CHINA                     |   1995 | 4649181583.46722
 CHINA                     |   1994 | 4696598860.33567
 CHINA                     |   1993 | 4683011847.59083
 CHINA                     |   1992 | 4662292857.82407
 EGYPT                     |   1998 | 2724323624.51744
 EGYPT                     |   1997 | 4645976272.53914
 EGYPT                     |   1996 | 4675431228.80615
 EGYPT                     |   1995 | 4663303605.65449
 EGYPT                     |   1994 |  4653960302.0596
 EGYPT                     |   1993 | 4668457162.19092
 EGYPT                     |   1992 | 4649122553.80473
 ETHIOPIA                  |   1998 | 2774671530.39906
 ETHIOPIA                  |   1997 | 4693110756.42195
 ETHIOPIA                  |   1996 | 4707223619.01911
 ETHIOPIA                  |   1995 | 4707571017.98924
 ETHIOPIA                  |   1994 | 4719331284.45866
 ETHIOPIA                  |   1993 | 4717438464.52226
 ETHIOPIA                  |   1992 |   4717116380.278
 FRANCE                    |   1998 | 2725699571.54247
 FRANCE                    |   1997 | 4673660015.28633
 FRANCE                    |   1996 | 4698785676.62389
 FRANCE                    |   1995 | 4668962109.62721
 FRANCE                    |   1994 | 4667300973.14441
 FRANCE                    |   1993 | 4663983154.90699
 FRANCE                    |   1992 | 4687250112.64103
 GERMANY                   |   1998 | 2730926564.66209
 GERMANY                   |   1997 | 4657288580.83946
 GERMANY                   |   1996 | 4699957161.04993
 GERMANY                   |   1995 | 4632222956.48901
 GERMANY                   |   1994 | 4658086963.60133
 GERMANY                   |   1993 | 4673881754.81916
 GERMANY                   |   1992 | 4674014814.70924
 INDIA                     |   1998 | 2743556538.11801
 INDIA                     |   1997 | 4673880136.01214
 INDIA                     |   1996 |  4700265048.8563
 INDIA                     |   1995 | 4660807094.85357
 INDIA                     |   1994 | 4674887035.59416
 INDIA                     |   1993 | 4671118559.57489
 INDIA                     |   1992 | 4701179726.71563
 INDONESIA                 |   1998 | 2721989633.41486
 INDONESIA                 |   1997 | 4632947329.84569
 INDONESIA                 |   1996 | 4642389724.86784
 INDONESIA                 |   1995 | 4647741004.64437
 INDONESIA                 |   1994 | 4629715200.89562
 INDONESIA                 |   1993 | 4637623059.09916
 INDONESIA                 |   1992 | 4625235774.06725
 IRAN                      |   1998 | 2720040959.64383
 IRAN                      |   1997 | 4620241438.55835
 IRAN                      |   1996 | 4660824991.45379
 IRAN                      |   1995 | 4612333927.21055
 IRAN                      |   1994 | 4608199986.94424
 IRAN                      |   1993 | 4632231172.03993
 IRAN                      |   1992 | 4645172742.45355
 IRAQ                      |   1998 |  2724630739.9302
 IRAQ                      |   1997 | 4651952438.98421
 IRAQ                      |   1996 | 4651047162.91841
 IRAQ                      |   1995 | 4644491865.36611
 IRAQ                      |   1994 | 4632046103.89778
 IRAQ                      |   1993 | 4663700579.84886
 IRAQ                      |   1992 | 4695147846.26331
 JAPAN                     |   1998 | 2730422949.85327
 JAPAN                     |   1997 | 4625956456.41313
 JAPAN                     |   1996 |  4656117999.7754
 JAPAN                     |   1995 | 4679262389.48026
 JAPAN                     |   1994 |  4641895502.7019
 JAPAN                     |   1993 | 4624371084.62716
 JAPAN                     |   1992 |   4658540374.323
 JORDAN                    |   1998 | 2737879209.00621
 JORDAN                    |   1997 | 4660786916.88484
 JORDAN                    |   1996 | 4653699676.29023
 JORDAN                    |   1995 |  4662151725.6294
 JORDAN                    |   1994 | 4639226527.84749
 JORDAN                    |   1993 | 4677871249.73619
 JORDAN                    |   1992 | 4643409902.06279
 KENYA                     |   1998 | 2710030833.17709
 KENYA                     |   1997 | 4609502799.94728
 KENYA                     |   1996 | 4627473897.49628
 KENYA                     |   1995 | 4616060711.25971
 KENYA                     |   1994 | 4631010360.91903
 KENYA                     |   1993 | 4630557963.46335
 KENYA                     |   1992 |  4636702444.7904
 MOROCCO                   |   1998 |  2743570801.9921
 MOROCCO                   |   1997 | 4689949063.37361
 MOROCCO                   |   1996 | 4702229557.42165
 MOROCCO                   |   1995 |  4655946473.3072
 MOROCCO                   |   1994 | 4673091613.02227
 MOROCCO                   |   1993 | 4696884592.61988
 MOROCCO                   |   1992 | 4671240094.59983
 MOZAMBIQUE                |   1998 | 2757702382.66148
 MOZAMBIQUE                |   1997 | 4694081092.70911
 MOZAMBIQUE                |   1996 | 4696076870.24081
 MOZAMBIQUE                |   1995 |  4662882789.9568
 MOZAMBIQUE                |   1994 | 4669376146.37129
 MOZAMBIQUE                |   1993 | 4659181794.13541
 MOZAMBIQUE                |   1992 | 4677482626.03598
 PERU                      |   1998 | 2711753095.69584
 PERU                      |   1997 | 4675568100.89824
 PERU                      |   1996 | 4670455797.01207
 PERU                      |   1995 | 4673878266.96539
 PERU                      |   1994 | 4663397768.13973
 PERU                      |   1993 | 4670874579.91115
 PERU                      |   1992 | 4693710324.01784
 ROMANIA                   |   1998 | 2747459010.33306
 ROMANIA                   |   1997 | 4667634464.73453
 ROMANIA                   |   1996 | 4699289423.80098
 ROMANIA                   |   1995 | 4665832507.87689
 ROMANIA                   |   1994 | 4688746546.88978
 ROMANIA                   |   1993 | 4668555968.01735
 ROMANIA                   |   1992 | 4683022192.64649
 RUSSIA                    |   1998 | 2725841523.77158
 RUSSIA                    |   1997 |  4654657525.7345
 RUSSIA                    |   1996 | 4665943964.77792
 RUSSIA                    |   1995 | 4662498824.95262
 RUSSIA                    |   1994 | 4656893992.87268
 RUSSIA                    |   1993 | 4637864191.90315
 RUSSIA                    |   1992 | 4661872611.34447
 SAUDI ARABIA              |   1998 | 2729883310.54638
 SAUDI ARABIA              |   1997 | 4667262497.35509
 SAUDI ARABIA              |   1996 | 4699519441.92977
 SAUDI ARABIA              |   1995 | 4641640344.03336
 SAUDI ARABIA              |   1994 | 4667008453.84862
 SAUDI ARABIA              |   1993 | 4637157434.38357
 SAUDI ARABIA              |   1992 | 4683687765.28984
 UNITED KINGDOM            |   1998 | 2762318860.07095
 UNITED KINGDOM            |   1997 |  4713103065.8293
 UNITED KINGDOM            |   1996 | 4728094460.40592
 UNITED KINGDOM            |   1995 | 4716108045.09633
 UNITED KINGDOM            |   1994 | 4698994528.04561
 UNITED KINGDOM            |   1993 | 4700119839.96225
 UNITED KINGDOM            |   1992 | 4721800085.90589
 UNITED STATES             |   1998 | 2740610978.50791
 UNITED STATES             |   1997 | 4666179008.41778
 UNITED STATES             |   1996 | 4671809045.67015
 UNITED STATES             |   1995 |  4644634007.7241
 UNITED STATES             |   1994 | 4653825496.76456
 UNITED STATES             |   1993 | 4687183874.05833
 UNITED STATES             |   1992 | 4701858191.79856
 VIETNAM                   |   1998 | 2759935058.15639
 VIETNAM                   |   1997 | 4678545221.38171
 VIETNAM                   |   1996 | 4708971760.19023
 VIETNAM                   |   1995 | 4698261983.75628
 VIETNAM                   |   1994 | 4685364125.82576
 VIETNAM                   |   1993 | 4697404924.77096
 VIETNAM                   |   1992 | 4699009252.33046
(175 rows)

COMMIT;
COMMIT
