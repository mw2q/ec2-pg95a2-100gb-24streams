BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%rose%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2747467337.89882
 ALGERIA                   |   1997 | 4709552558.13574
 ALGERIA                   |   1996 | 4697731895.26868
 ALGERIA                   |   1995 | 4683283242.66606
 ALGERIA                   |   1994 | 4692971963.17113
 ALGERIA                   |   1993 | 4679107558.53354
 ALGERIA                   |   1992 | 4709467793.72459
 ARGENTINA                 |   1998 | 2722032918.46485
 ARGENTINA                 |   1997 | 4676673135.20044
 ARGENTINA                 |   1996 | 4648551883.29021
 ARGENTINA                 |   1995 |  4639617015.9457
 ARGENTINA                 |   1994 | 4639733640.13799
 ARGENTINA                 |   1993 |  4637961112.2124
 ARGENTINA                 |   1992 | 4659019595.22851
 BRAZIL                    |   1998 | 2735272252.21999
 BRAZIL                    |   1997 | 4674064524.18925
 BRAZIL                    |   1996 | 4655846845.94057
 BRAZIL                    |   1995 | 4670093213.97757
 BRAZIL                    |   1994 | 4663377143.78101
 BRAZIL                    |   1993 | 4692552847.77535
 BRAZIL                    |   1992 | 4674920840.41093
 CANADA                    |   1998 | 2751687585.82709
 CANADA                    |   1997 | 4713553667.90443
 CANADA                    |   1996 | 4715666592.05978
 CANADA                    |   1995 | 4674154871.55428
 CANADA                    |   1994 | 4698502503.93924
 CANADA                    |   1993 | 4679388954.88463
 CANADA                    |   1992 | 4706791928.73949
 CHINA                     |   1998 | 2714922908.66356
 CHINA                     |   1997 | 4659969673.55266
 CHINA                     |   1996 | 4673217412.40969
 CHINA                     |   1995 | 4658938224.36369
 CHINA                     |   1994 | 4665278166.93752
 CHINA                     |   1993 | 4653522648.64948
 CHINA                     |   1992 | 4658810833.97868
 EGYPT                     |   1998 | 2729265359.38834
 EGYPT                     |   1997 | 4680537693.60414
 EGYPT                     |   1996 |  4663287530.9855
 EGYPT                     |   1995 | 4660713778.64887
 EGYPT                     |   1994 | 4655118092.85951
 EGYPT                     |   1993 | 4659259963.79492
 EGYPT                     |   1992 | 4664880179.63526
 ETHIOPIA                  |   1998 | 2757419452.34636
 ETHIOPIA                  |   1997 | 4677850038.38168
 ETHIOPIA                  |   1996 | 4699512742.88699
 ETHIOPIA                  |   1995 | 4681395148.10568
 ETHIOPIA                  |   1994 | 4694586712.53548
 ETHIOPIA                  |   1993 | 4688761854.22816
 ETHIOPIA                  |   1992 | 4692249105.16735
 FRANCE                    |   1998 | 2727726768.94112
 FRANCE                    |   1997 | 4659906549.11097
 FRANCE                    |   1996 | 4699096613.05034
 FRANCE                    |   1995 | 4639789920.54468
 FRANCE                    |   1994 | 4656147391.06229
 FRANCE                    |   1993 | 4628880360.52358
 FRANCE                    |   1992 | 4671162002.60584
 GERMANY                   |   1998 | 2736896365.34107
 GERMANY                   |   1997 | 4671989147.47856
 GERMANY                   |   1996 |  4662240057.8464
 GERMANY                   |   1995 | 4663767778.21615
 GERMANY                   |   1994 | 4659674139.50837
 GERMANY                   |   1993 | 4688798324.73454
 GERMANY                   |   1992 | 4682298341.08169
 INDIA                     |   1998 | 2748006465.01094
 INDIA                     |   1997 | 4663679566.85123
 INDIA                     |   1996 | 4682643328.79756
 INDIA                     |   1995 | 4674395738.83742
 INDIA                     |   1994 |  4672213819.6073
 INDIA                     |   1993 | 4664744312.99682
 INDIA                     |   1992 | 4691632539.31043
 INDONESIA                 |   1998 | 2706117642.67004
 INDONESIA                 |   1997 | 4617091143.02896
 INDONESIA                 |   1996 | 4631061395.62825
 INDONESIA                 |   1995 |  4617132999.4863
 INDONESIA                 |   1994 | 4626320817.25669
 INDONESIA                 |   1993 | 4627447780.07293
 INDONESIA                 |   1992 | 4631672832.40902
 IRAN                      |   1998 | 2716193526.55346
 IRAN                      |   1997 | 4659933511.22916
 IRAN                      |   1996 | 4646933428.54871
 IRAN                      |   1995 | 4621536827.15333
 IRAN                      |   1994 |  4616575224.1976
 IRAN                      |   1993 | 4627594201.75281
 IRAN                      |   1992 | 4629662390.42148
 IRAQ                      |   1998 |  2721197989.6298
 IRAQ                      |   1997 | 4632945004.60525
 IRAQ                      |   1996 | 4654365767.17903
 IRAQ                      |   1995 | 4655535344.79195
 IRAQ                      |   1994 | 4648053640.78121
 IRAQ                      |   1993 | 4646187679.80698
 IRAQ                      |   1992 | 4677895748.18047
 JAPAN                     |   1998 | 2712169274.50934
 JAPAN                     |   1997 | 4638237498.74384
 JAPAN                     |   1996 | 4631230074.84779
 JAPAN                     |   1995 | 4635526037.33049
 JAPAN                     |   1994 | 4632265944.79159
 JAPAN                     |   1993 | 4615194881.28633
 JAPAN                     |   1992 | 4628756568.20876
 JORDAN                    |   1998 | 2717601334.78583
 JORDAN                    |   1997 | 4639536634.00374
 JORDAN                    |   1996 | 4657999461.47654
 JORDAN                    |   1995 | 4652673912.33737
 JORDAN                    |   1994 | 4646070702.06986
 JORDAN                    |   1993 | 4626683760.86283
 JORDAN                    |   1992 | 4657400497.39054
 KENYA                     |   1998 | 2713190378.53711
 KENYA                     |   1997 | 4625086922.25215
 KENYA                     |   1996 | 4644205624.66326
 KENYA                     |   1995 |  4635483969.3332
 KENYA                     |   1994 | 4647169733.02915
 KENYA                     |   1993 | 4632360163.84387
 KENYA                     |   1992 | 4653748725.63459
 MOROCCO                   |   1998 | 2744124548.16138
 MOROCCO                   |   1997 | 4694377630.05695
 MOROCCO                   |   1996 |   4696307914.525
 MOROCCO                   |   1995 | 4676852981.03488
 MOROCCO                   |   1994 | 4652458005.37461
 MOROCCO                   |   1993 |  4676459450.3078
 MOROCCO                   |   1992 | 4693760039.81384
 MOZAMBIQUE                |   1998 |  2728963554.7419
 MOZAMBIQUE                |   1997 | 4676710504.22743
 MOZAMBIQUE                |   1996 | 4672753838.88256
 MOZAMBIQUE                |   1995 | 4634546142.20641
 MOZAMBIQUE                |   1994 | 4624934817.56113
 MOZAMBIQUE                |   1993 | 4627387647.45188
 MOZAMBIQUE                |   1992 | 4665871662.81904
 PERU                      |   1998 | 2717984020.01983
 PERU                      |   1997 | 4648389751.28212
 PERU                      |   1996 | 4653326929.64814
 PERU                      |   1995 | 4638171154.50793
 PERU                      |   1994 |  4646120034.6685
 PERU                      |   1993 | 4642488047.89551
 PERU                      |   1992 | 4634927855.82911
 ROMANIA                   |   1998 | 2734326370.35868
 ROMANIA                   |   1997 | 4654482708.38613
 ROMANIA                   |   1996 | 4668641063.72571
 ROMANIA                   |   1995 | 4654239835.88266
 ROMANIA                   |   1994 | 4646571288.98733
 ROMANIA                   |   1993 | 4642853580.72976
 ROMANIA                   |   1992 | 4652517767.62769
 RUSSIA                    |   1998 | 2735776971.13002
 RUSSIA                    |   1997 |  4659445108.4302
 RUSSIA                    |   1996 | 4657185589.59658
 RUSSIA                    |   1995 | 4651915855.51861
 RUSSIA                    |   1994 | 4663754684.36829
 RUSSIA                    |   1993 | 4654357783.61608
 RUSSIA                    |   1992 | 4679011013.37864
 SAUDI ARABIA              |   1998 | 2731057147.67116
 SAUDI ARABIA              |   1997 | 4606284014.66026
 SAUDI ARABIA              |   1996 | 4662150622.41001
 SAUDI ARABIA              |   1995 | 4628848010.83547
 SAUDI ARABIA              |   1994 | 4641775354.20153
 SAUDI ARABIA              |   1993 | 4635683604.38771
 SAUDI ARABIA              |   1992 | 4651567541.82888
 UNITED KINGDOM            |   1998 | 2755815638.91629
 UNITED KINGDOM            |   1997 | 4710408855.32298
 UNITED KINGDOM            |   1996 | 4686641786.58374
 UNITED KINGDOM            |   1995 | 4713399710.39644
 UNITED KINGDOM            |   1994 |  4682063851.8166
 UNITED KINGDOM            |   1993 | 4675356539.17676
 UNITED KINGDOM            |   1992 | 4691289805.75095
 UNITED STATES             |   1998 | 2753192412.09585
 UNITED STATES             |   1997 | 4656921718.62574
 UNITED STATES             |   1996 |  4690296959.3695
 UNITED STATES             |   1995 | 4655505959.21937
 UNITED STATES             |   1994 | 4690738664.67046
 UNITED STATES             |   1993 | 4636962209.81279
 UNITED STATES             |   1992 | 4677058962.65059
 VIETNAM                   |   1998 | 2741760288.58569
 VIETNAM                   |   1997 | 4685886785.94975
 VIETNAM                   |   1996 | 4693597376.64069
 VIETNAM                   |   1995 | 4682509355.63644
 VIETNAM                   |   1994 | 4674179479.10807
 VIETNAM                   |   1993 |  4712882433.8687
 VIETNAM                   |   1992 | 4680927867.27919
(175 rows)

COMMIT;
COMMIT
