BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peru%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2711388806.84031
 ALGERIA                   |   1997 | 4619176059.41062
 ALGERIA                   |   1996 | 4660075428.31406
 ALGERIA                   |   1995 | 4661392546.32954
 ALGERIA                   |   1994 | 4657440823.75205
 ALGERIA                   |   1993 | 4656178191.96098
 ALGERIA                   |   1992 | 4647893798.34044
 ARGENTINA                 |   1998 | 2719636455.98912
 ARGENTINA                 |   1997 |  4626300995.8231
 ARGENTINA                 |   1996 | 4673058197.35481
 ARGENTINA                 |   1995 | 4646486462.28916
 ARGENTINA                 |   1994 |  4632494903.0636
 ARGENTINA                 |   1993 | 4615137538.93849
 ARGENTINA                 |   1992 | 4633051958.91387
 BRAZIL                    |   1998 | 2738013843.24893
 BRAZIL                    |   1997 |  4691806666.0279
 BRAZIL                    |   1996 | 4699861990.70226
 BRAZIL                    |   1995 | 4696998546.84491
 BRAZIL                    |   1994 | 4662001114.03087
 BRAZIL                    |   1993 | 4655389433.82922
 BRAZIL                    |   1992 | 4682070203.80978
 CANADA                    |   1998 |  2764039325.0746
 CANADA                    |   1997 | 4702827986.51665
 CANADA                    |   1996 | 4708108522.85222
 CANADA                    |   1995 | 4690444524.92523
 CANADA                    |   1994 | 4710386778.01326
 CANADA                    |   1993 | 4720602387.64389
 CANADA                    |   1992 | 4705481557.59193
 CHINA                     |   1998 | 2732710055.27158
 CHINA                     |   1997 | 4648915093.14301
 CHINA                     |   1996 | 4672707014.08528
 CHINA                     |   1995 | 4648326438.66771
 CHINA                     |   1994 | 4654554536.05429
 CHINA                     |   1993 | 4640850884.76893
 CHINA                     |   1992 | 4670266858.14154
 EGYPT                     |   1998 | 2729443964.20939
 EGYPT                     |   1997 | 4673081888.47281
 EGYPT                     |   1996 | 4672669952.20757
 EGYPT                     |   1995 | 4656312878.97119
 EGYPT                     |   1994 | 4666767361.74273
 EGYPT                     |   1993 | 4650319696.33122
 EGYPT                     |   1992 | 4680068750.59898
 ETHIOPIA                  |   1998 | 2741062505.76437
 ETHIOPIA                  |   1997 | 4683754073.40401
 ETHIOPIA                  |   1996 | 4682129690.58173
 ETHIOPIA                  |   1995 |  4660757499.4587
 ETHIOPIA                  |   1994 | 4718193033.41154
 ETHIOPIA                  |   1993 | 4672085021.72204
 ETHIOPIA                  |   1992 |  4700095330.5178
 FRANCE                    |   1998 | 2735423252.88106
 FRANCE                    |   1997 | 4685016558.06226
 FRANCE                    |   1996 | 4677968606.59989
 FRANCE                    |   1995 | 4699766410.57671
 FRANCE                    |   1994 | 4687501224.16028
 FRANCE                    |   1993 |   4669178923.447
 FRANCE                    |   1992 | 4696006692.74031
 GERMANY                   |   1998 | 2767378662.95514
 GERMANY                   |   1997 | 4703530962.97014
 GERMANY                   |   1996 | 4707812629.27256
 GERMANY                   |   1995 | 4702428473.95528
 GERMANY                   |   1994 | 4686701760.97915
 GERMANY                   |   1993 |   4693994587.044
 GERMANY                   |   1992 |  4691964165.1423
 INDIA                     |   1998 | 2747405020.23803
 INDIA                     |   1997 | 4683297051.01411
 INDIA                     |   1996 | 4669658134.35976
 INDIA                     |   1995 | 4680930829.36515
 INDIA                     |   1994 | 4693384118.96357
 INDIA                     |   1993 | 4681557173.83528
 INDIA                     |   1992 | 4706196342.91526
 INDONESIA                 |   1998 | 2736244287.19807
 INDONESIA                 |   1997 | 4645783781.44441
 INDONESIA                 |   1996 | 4652561899.86315
 INDONESIA                 |   1995 | 4636499848.92704
 INDONESIA                 |   1994 | 4643374890.24377
 INDONESIA                 |   1993 |  4620343199.4568
 INDONESIA                 |   1992 | 4652492543.66291
 IRAN                      |   1998 | 2745900618.45951
 IRAN                      |   1997 | 4644736274.56037
 IRAN                      |   1996 | 4661448747.36518
 IRAN                      |   1995 | 4640437498.63873
 IRAN                      |   1994 | 4625695647.84938
 IRAN                      |   1993 |  4643808872.4519
 IRAN                      |   1992 | 4674260946.30134
 IRAQ                      |   1998 | 2719193378.49367
 IRAQ                      |   1997 | 4640771042.98197
 IRAQ                      |   1996 | 4651505687.16183
 IRAQ                      |   1995 | 4609899471.27412
 IRAQ                      |   1994 | 4634659089.93689
 IRAQ                      |   1993 | 4616844075.42005
 IRAQ                      |   1992 | 4639406527.51668
 JAPAN                     |   1998 | 2722995815.74268
 JAPAN                     |   1997 | 4623144217.28693
 JAPAN                     |   1996 | 4655230650.86126
 JAPAN                     |   1995 | 4635411217.68386
 JAPAN                     |   1994 | 4624709199.15153
 JAPAN                     |   1993 | 4610132876.01344
 JAPAN                     |   1992 |  4661623758.6239
 JORDAN                    |   1998 | 2743111644.82564
 JORDAN                    |   1997 |  4619154982.2669
 JORDAN                    |   1996 | 4659726218.62374
 JORDAN                    |   1995 | 4650739120.24224
 JORDAN                    |   1994 | 4647213597.60938
 JORDAN                    |   1993 | 4671121794.05958
 JORDAN                    |   1992 | 4660526912.09614
 KENYA                     |   1998 | 2696087769.97148
 KENYA                     |   1997 | 4619175605.15982
 KENYA                     |   1996 | 4639148686.10521
 KENYA                     |   1995 | 4596320858.01258
 KENYA                     |   1994 | 4609685742.47402
 KENYA                     |   1993 | 4619787118.58038
 KENYA                     |   1992 | 4615152356.43648
 MOROCCO                   |   1998 | 2751182315.23755
 MOROCCO                   |   1997 | 4674693249.83201
 MOROCCO                   |   1996 | 4705229949.09489
 MOROCCO                   |   1995 |  4636500958.2848
 MOROCCO                   |   1994 | 4649078327.73488
 MOROCCO                   |   1993 | 4670316848.94172
 MOROCCO                   |   1992 | 4677486303.21713
 MOZAMBIQUE                |   1998 | 2723572875.16346
 MOZAMBIQUE                |   1997 | 4617198066.28151
 MOZAMBIQUE                |   1996 |  4655746009.2327
 MOZAMBIQUE                |   1995 | 4643258049.11906
 MOZAMBIQUE                |   1994 | 4653312650.11397
 MOZAMBIQUE                |   1993 |  4648284597.1382
 MOZAMBIQUE                |   1992 | 4661163902.11611
 PERU                      |   1998 | 2713203698.92907
 PERU                      |   1997 | 4607830160.63919
 PERU                      |   1996 | 4633953183.97311
 PERU                      |   1995 | 4643645194.55116
 PERU                      |   1994 | 4640607615.24089
 PERU                      |   1993 | 4622201795.48058
 PERU                      |   1992 | 4645899365.42367
 ROMANIA                   |   1998 |  2742853368.4899
 ROMANIA                   |   1997 | 4699183332.66497
 ROMANIA                   |   1996 | 4712170124.14414
 ROMANIA                   |   1995 | 4677800123.56234
 ROMANIA                   |   1994 | 4684058089.53966
 ROMANIA                   |   1993 | 4684057449.79074
 ROMANIA                   |   1992 | 4676804977.58241
 RUSSIA                    |   1998 | 2719803464.96476
 RUSSIA                    |   1997 | 4662208927.78218
 RUSSIA                    |   1996 | 4680739767.42532
 RUSSIA                    |   1995 | 4662787123.04005
 RUSSIA                    |   1994 | 4655925392.93036
 RUSSIA                    |   1993 | 4655713894.36615
 RUSSIA                    |   1992 | 4672211280.42865
 SAUDI ARABIA              |   1998 | 2723793260.21819
 SAUDI ARABIA              |   1997 | 4632917323.70503
 SAUDI ARABIA              |   1996 | 4669933907.99706
 SAUDI ARABIA              |   1995 |  4615626592.6195
 SAUDI ARABIA              |   1994 | 4650289303.75669
 SAUDI ARABIA              |   1993 |  4637937233.3561
 SAUDI ARABIA              |   1992 | 4675367992.55053
 UNITED KINGDOM            |   1998 | 2756372970.59215
 UNITED KINGDOM            |   1997 | 4696739639.27224
 UNITED KINGDOM            |   1996 | 4696038021.85119
 UNITED KINGDOM            |   1995 | 4685645645.03711
 UNITED KINGDOM            |   1994 | 4687764974.70423
 UNITED KINGDOM            |   1993 | 4675717924.24868
 UNITED KINGDOM            |   1992 |  4684907212.4095
 UNITED STATES             |   1998 | 2739883594.45027
 UNITED STATES             |   1997 | 4662564413.12829
 UNITED STATES             |   1996 | 4678681813.78868
 UNITED STATES             |   1995 | 4665367388.47295
 UNITED STATES             |   1994 | 4650864895.52104
 UNITED STATES             |   1993 | 4686856961.74183
 UNITED STATES             |   1992 | 4673254716.43221
 VIETNAM                   |   1998 | 2743571973.72013
 VIETNAM                   |   1997 |  4686368766.2234
 VIETNAM                   |   1996 | 4704654891.61125
 VIETNAM                   |   1995 | 4702339254.10846
 VIETNAM                   |   1994 | 4690342163.85371
 VIETNAM                   |   1993 | 4688830250.74155
 VIETNAM                   |   1992 | 4710272580.67121
(175 rows)

COMMIT;
COMMIT
