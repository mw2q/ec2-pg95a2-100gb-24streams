BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%spring%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2722443139.17879
 ALGERIA                   |   1997 | 4673619485.06554
 ALGERIA                   |   1996 | 4665086540.62251
 ALGERIA                   |   1995 |  4640337722.0535
 ALGERIA                   |   1994 | 4658688859.62417
 ALGERIA                   |   1993 | 4648419857.78289
 ALGERIA                   |   1992 | 4671079912.77763
 ARGENTINA                 |   1998 | 2733248657.45709
 ARGENTINA                 |   1997 | 4632217422.88198
 ARGENTINA                 |   1996 | 4659555623.21833
 ARGENTINA                 |   1995 | 4659759081.31329
 ARGENTINA                 |   1994 | 4648742412.39731
 ARGENTINA                 |   1993 | 4635759797.37806
 ARGENTINA                 |   1992 | 4667643280.30727
 BRAZIL                    |   1998 | 2746742955.00525
 BRAZIL                    |   1997 | 4675531925.15393
 BRAZIL                    |   1996 | 4664007232.28075
 BRAZIL                    |   1995 | 4672660392.81151
 BRAZIL                    |   1994 | 4646764687.03222
 BRAZIL                    |   1993 | 4668232790.03371
 BRAZIL                    |   1992 | 4677132128.41515
 CANADA                    |   1998 | 2745173858.48856
 CANADA                    |   1997 | 4680747614.80433
 CANADA                    |   1996 | 4684578485.53526
 CANADA                    |   1995 | 4679585819.93409
 CANADA                    |   1994 | 4654068075.71043
 CANADA                    |   1993 | 4664406628.22338
 CANADA                    |   1992 |  4687866295.7484
 CHINA                     |   1998 | 2733891410.27657
 CHINA                     |   1997 | 4647073316.63268
 CHINA                     |   1996 | 4675413061.69337
 CHINA                     |   1995 | 4681280664.54781
 CHINA                     |   1994 | 4658810646.81536
 CHINA                     |   1993 | 4657613287.55892
 CHINA                     |   1992 | 4677588521.59889
 EGYPT                     |   1998 | 2726095071.19863
 EGYPT                     |   1997 | 4653957381.57919
 EGYPT                     |   1996 | 4660608126.80281
 EGYPT                     |   1995 | 4657723582.96317
 EGYPT                     |   1994 | 4635820312.05797
 EGYPT                     |   1993 | 4663864183.19687
 EGYPT                     |   1992 | 4656826195.02789
 ETHIOPIA                  |   1998 | 2780029043.08444
 ETHIOPIA                  |   1997 | 4713588712.72147
 ETHIOPIA                  |   1996 |  4724372874.8859
 ETHIOPIA                  |   1995 | 4693949387.97042
 ETHIOPIA                  |   1994 | 4712070146.55271
 ETHIOPIA                  |   1993 | 4696359220.22049
 ETHIOPIA                  |   1992 | 4717613622.45366
 FRANCE                    |   1998 | 2746453083.56882
 FRANCE                    |   1997 | 4693797856.50204
 FRANCE                    |   1996 |  4727609004.2699
 FRANCE                    |   1995 | 4684875257.23068
 FRANCE                    |   1994 | 4681810464.57226
 FRANCE                    |   1993 | 4689078632.45842
 FRANCE                    |   1992 | 4709227839.96514
 GERMANY                   |   1998 |  2747389478.5237
 GERMANY                   |   1997 | 4689407045.10184
 GERMANY                   |   1996 | 4710625729.95621
 GERMANY                   |   1995 | 4693672500.64286
 GERMANY                   |   1994 | 4683056915.60459
 GERMANY                   |   1993 | 4686783030.14781
 GERMANY                   |   1992 | 4727693921.87921
 INDIA                     |   1998 | 2743014727.11636
 INDIA                     |   1997 | 4659300534.61853
 INDIA                     |   1996 | 4665034612.00757
 INDIA                     |   1995 |  4648727894.8362
 INDIA                     |   1994 | 4683632671.19629
 INDIA                     |   1993 | 4655053189.87694
 INDIA                     |   1992 | 4674683560.70886
 INDONESIA                 |   1998 | 2706164475.15907
 INDONESIA                 |   1997 | 4631160869.98465
 INDONESIA                 |   1996 | 4642948733.23247
 INDONESIA                 |   1995 | 4628353160.92837
 INDONESIA                 |   1994 | 4639703963.52709
 INDONESIA                 |   1993 | 4636375512.44685
 INDONESIA                 |   1992 | 4641710462.93934
 IRAN                      |   1998 | 2728734107.84614
 IRAN                      |   1997 |  4647804125.6771
 IRAN                      |   1996 | 4653115375.32608
 IRAN                      |   1995 | 4659043420.07886
 IRAN                      |   1994 | 4626283254.00483
 IRAN                      |   1993 | 4647714126.52108
 IRAN                      |   1992 | 4630300560.80678
 IRAQ                      |   1998 | 2701550895.13074
 IRAQ                      |   1997 | 4620397941.33273
 IRAQ                      |   1996 | 4634653026.92486
 IRAQ                      |   1995 | 4608029805.37045
 IRAQ                      |   1994 | 4628336905.03368
 IRAQ                      |   1993 | 4624034276.87701
 IRAQ                      |   1992 | 4637869576.89839
 JAPAN                     |   1998 | 2711467445.44952
 JAPAN                     |   1997 | 4612795412.12657
 JAPAN                     |   1996 |  4634271071.8856
 JAPAN                     |   1995 | 4650896019.59683
 JAPAN                     |   1994 | 4631648297.66596
 JAPAN                     |   1993 | 4627694885.66496
 JAPAN                     |   1992 | 4628366410.13276
 JORDAN                    |   1998 | 2727821696.72885
 JORDAN                    |   1997 |  4661535885.5991
 JORDAN                    |   1996 |  4664570929.6215
 JORDAN                    |   1995 | 4673181498.18309
 JORDAN                    |   1994 |  4671938992.4269
 JORDAN                    |   1993 | 4658906402.55723
 JORDAN                    |   1992 | 4665978020.44959
 KENYA                     |   1998 | 2728976604.79533
 KENYA                     |   1997 | 4655034521.19135
 KENYA                     |   1996 | 4630717477.17538
 KENYA                     |   1995 | 4643031268.94231
 KENYA                     |   1994 | 4618296469.59242
 KENYA                     |   1993 | 4627643692.32534
 KENYA                     |   1992 | 4634400124.16586
 MOROCCO                   |   1998 | 2750127278.80153
 MOROCCO                   |   1997 | 4692388211.79842
 MOROCCO                   |   1996 | 4691032557.76061
 MOROCCO                   |   1995 | 4698420563.66909
 MOROCCO                   |   1994 | 4679905231.58956
 MOROCCO                   |   1993 | 4687107742.20993
 MOROCCO                   |   1992 | 4705911657.20034
 MOZAMBIQUE                |   1998 | 2717062663.36179
 MOZAMBIQUE                |   1997 | 4630785073.99148
 MOZAMBIQUE                |   1996 | 4650008146.75081
 MOZAMBIQUE                |   1995 | 4621113747.87566
 MOZAMBIQUE                |   1994 | 4629901276.97902
 MOZAMBIQUE                |   1993 | 4622812200.55178
 MOZAMBIQUE                |   1992 | 4668480303.17935
 PERU                      |   1998 | 2722575003.11529
 PERU                      |   1997 | 4616280147.14421
 PERU                      |   1996 | 4643318597.53606
 PERU                      |   1995 | 4643518939.24408
 PERU                      |   1994 |  4618872951.6527
 PERU                      |   1993 | 4599071124.61535
 PERU                      |   1992 | 4633316778.03993
 ROMANIA                   |   1998 | 2752833834.94475
 ROMANIA                   |   1997 | 4671362793.32514
 ROMANIA                   |   1996 | 4687559129.89034
 ROMANIA                   |   1995 | 4691094659.85384
 ROMANIA                   |   1994 | 4698249607.30444
 ROMANIA                   |   1993 | 4689471579.38128
 ROMANIA                   |   1992 | 4702878448.62467
 RUSSIA                    |   1998 |  2726470822.2578
 RUSSIA                    |   1997 | 4666872944.57258
 RUSSIA                    |   1996 | 4685195050.83373
 RUSSIA                    |   1995 | 4661186539.79232
 RUSSIA                    |   1994 | 4675121553.59971
 RUSSIA                    |   1993 |  4673432872.0605
 RUSSIA                    |   1992 | 4678185792.06752
 SAUDI ARABIA              |   1998 | 2729984103.07987
 SAUDI ARABIA              |   1997 | 4684245642.32549
 SAUDI ARABIA              |   1996 | 4697803519.97216
 SAUDI ARABIA              |   1995 | 4693389748.68129
 SAUDI ARABIA              |   1994 | 4658580010.82081
 SAUDI ARABIA              |   1993 |  4676127033.4326
 SAUDI ARABIA              |   1992 | 4686972632.41936
 UNITED KINGDOM            |   1998 | 2756002206.38001
 UNITED KINGDOM            |   1997 | 4694337031.24685
 UNITED KINGDOM            |   1996 | 4695169433.16984
 UNITED KINGDOM            |   1995 | 4659992724.16311
 UNITED KINGDOM            |   1994 |  4689154069.2393
 UNITED KINGDOM            |   1993 | 4683857522.33393
 UNITED KINGDOM            |   1992 | 4699581252.57542
 UNITED STATES             |   1998 |  2753134794.5585
 UNITED STATES             |   1997 |   4677429224.976
 UNITED STATES             |   1996 | 4709886863.59364
 UNITED STATES             |   1995 | 4679296434.45888
 UNITED STATES             |   1994 | 4696141108.26546
 UNITED STATES             |   1993 | 4677747035.39305
 UNITED STATES             |   1992 | 4668261157.79284
 VIETNAM                   |   1998 |  2745084934.6192
 VIETNAM                   |   1997 | 4683144774.11471
 VIETNAM                   |   1996 | 4704015975.09504
 VIETNAM                   |   1995 | 4686180325.51368
 VIETNAM                   |   1994 | 4668011193.91836
 VIETNAM                   |   1993 | 4694443210.34714
 VIETNAM                   |   1992 | 4679592233.38013
(175 rows)

COMMIT;
COMMIT
