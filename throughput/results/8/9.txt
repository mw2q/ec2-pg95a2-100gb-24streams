BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%lime%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2729197923.33418
 ALGERIA                   |   1997 | 4676816828.63269
 ALGERIA                   |   1996 | 4690160535.54516
 ALGERIA                   |   1995 | 4682419054.15862
 ALGERIA                   |   1994 | 4680959597.64676
 ALGERIA                   |   1993 | 4670971307.88504
 ALGERIA                   |   1992 | 4668132613.68606
 ARGENTINA                 |   1998 |  2721113846.6684
 ARGENTINA                 |   1997 | 4651287068.85913
 ARGENTINA                 |   1996 |    4677858107.59
 ARGENTINA                 |   1995 | 4648138877.09504
 ARGENTINA                 |   1994 | 4637998763.38482
 ARGENTINA                 |   1993 | 4666267209.30513
 ARGENTINA                 |   1992 |  4648822903.6606
 BRAZIL                    |   1998 | 2734202693.60861
 BRAZIL                    |   1997 | 4688866148.87904
 BRAZIL                    |   1996 | 4718830369.13624
 BRAZIL                    |   1995 | 4708776415.77681
 BRAZIL                    |   1994 | 4689346361.40888
 BRAZIL                    |   1993 | 4664442340.54335
 BRAZIL                    |   1992 | 4712986158.81652
 CANADA                    |   1998 |  2754107935.5197
 CANADA                    |   1997 | 4672554400.38588
 CANADA                    |   1996 | 4723135928.35897
 CANADA                    |   1995 | 4690133720.97244
 CANADA                    |   1994 |  4676609781.1574
 CANADA                    |   1993 |  4684170693.5232
 CANADA                    |   1992 | 4716901328.44845
 CHINA                     |   1998 | 2741697222.06635
 CHINA                     |   1997 | 4706582758.32434
 CHINA                     |   1996 | 4694160248.43175
 CHINA                     |   1995 | 4670736330.93571
 CHINA                     |   1994 | 4678839329.32233
 CHINA                     |   1993 | 4686431299.58972
 CHINA                     |   1992 | 4689140064.24726
 EGYPT                     |   1998 | 2756827393.44234
 EGYPT                     |   1997 | 4670028433.30389
 EGYPT                     |   1996 | 4721827599.70125
 EGYPT                     |   1995 | 4647123468.02346
 EGYPT                     |   1994 | 4647621266.16626
 EGYPT                     |   1993 | 4690129705.58936
 EGYPT                     |   1992 | 4659633118.04903
 ETHIOPIA                  |   1998 | 2771914868.83358
 ETHIOPIA                  |   1997 | 4706290361.22437
 ETHIOPIA                  |   1996 | 4711452328.28882
 ETHIOPIA                  |   1995 | 4731400741.55571
 ETHIOPIA                  |   1994 | 4724168133.36233
 ETHIOPIA                  |   1993 | 4715277751.84473
 ETHIOPIA                  |   1992 | 4736634125.63894
 FRANCE                    |   1998 | 2753295690.76104
 FRANCE                    |   1997 | 4704479703.86521
 FRANCE                    |   1996 | 4699385354.28016
 FRANCE                    |   1995 | 4695465802.99768
 FRANCE                    |   1994 | 4707085670.26145
 FRANCE                    |   1993 |  4675309260.2585
 FRANCE                    |   1992 | 4712296635.27097
 GERMANY                   |   1998 | 2757866592.81854
 GERMANY                   |   1997 | 4722504252.58501
 GERMANY                   |   1996 | 4708981447.38387
 GERMANY                   |   1995 | 4720963123.04831
 GERMANY                   |   1994 | 4724169214.19928
 GERMANY                   |   1993 | 4712362397.78677
 GERMANY                   |   1992 | 4713782698.88264
 INDIA                     |   1998 | 2759999702.28289
 INDIA                     |   1997 | 4680201332.10462
 INDIA                     |   1996 | 4694216824.85851
 INDIA                     |   1995 | 4681253233.44607
 INDIA                     |   1994 | 4680023016.37123
 INDIA                     |   1993 | 4655955195.32456
 INDIA                     |   1992 | 4688944766.19571
 INDONESIA                 |   1998 | 2727305883.88116
 INDONESIA                 |   1997 | 4629451686.11335
 INDONESIA                 |   1996 | 4653639658.24106
 INDONESIA                 |   1995 | 4635792186.14612
 INDONESIA                 |   1994 | 4640506148.60123
 INDONESIA                 |   1993 | 4639587534.08629
 INDONESIA                 |   1992 | 4666844669.53503
 IRAN                      |   1998 | 2740308858.40387
 IRAN                      |   1997 | 4703070807.28031
 IRAN                      |   1996 | 4680439571.02239
 IRAN                      |   1995 | 4669761707.80487
 IRAN                      |   1994 | 4660784880.58466
 IRAN                      |   1993 | 4644730253.56573
 IRAN                      |   1992 | 4661744022.86045
 IRAQ                      |   1998 | 2742447579.63329
 IRAQ                      |   1997 |  4646422599.7734
 IRAQ                      |   1996 |  4648265972.8579
 IRAQ                      |   1995 | 4621085806.24942
 IRAQ                      |   1994 | 4631686965.09263
 IRAQ                      |   1993 | 4661493667.97501
 IRAQ                      |   1992 | 4649960999.26724
 JAPAN                     |   1998 | 2705048734.53221
 JAPAN                     |   1997 | 4616825325.21958
 JAPAN                     |   1996 | 4666450328.96969
 JAPAN                     |   1995 |  4650759734.1298
 JAPAN                     |   1994 | 4646729281.73306
 JAPAN                     |   1993 | 4635888642.51445
 JAPAN                     |   1992 |  4645744349.1468
 JORDAN                    |   1998 | 2742103074.74972
 JORDAN                    |   1997 |   4689231811.555
 JORDAN                    |   1996 | 4708969171.13083
 JORDAN                    |   1995 |   4694925547.189
 JORDAN                    |   1994 | 4723910557.85199
 JORDAN                    |   1993 | 4697096194.17015
 JORDAN                    |   1992 | 4712440683.90771
 KENYA                     |   1998 | 2718486618.71265
 KENYA                     |   1997 | 4621417076.42546
 KENYA                     |   1996 | 4649734115.80913
 KENYA                     |   1995 | 4611253336.44135
 KENYA                     |   1994 | 4629459385.53061
 KENYA                     |   1993 | 4624939837.91312
 KENYA                     |   1992 | 4636601047.36247
 MOROCCO                   |   1998 | 2735940512.82361
 MOROCCO                   |   1997 | 4682845388.91905
 MOROCCO                   |   1996 | 4689603511.28581
 MOROCCO                   |   1995 | 4699531327.23448
 MOROCCO                   |   1994 | 4695476768.80801
 MOROCCO                   |   1993 | 4687950488.87299
 MOROCCO                   |   1992 | 4696234069.24002
 MOZAMBIQUE                |   1998 | 2746223694.47288
 MOZAMBIQUE                |   1997 | 4688483201.73236
 MOZAMBIQUE                |   1996 | 4689350800.92105
 MOZAMBIQUE                |   1995 | 4659798158.22282
 MOZAMBIQUE                |   1994 | 4677775440.46658
 MOZAMBIQUE                |   1993 | 4666626586.79636
 MOZAMBIQUE                |   1992 | 4664815431.37839
 PERU                      |   1998 | 2708872888.36589
 PERU                      |   1997 |  4631837853.2802
 PERU                      |   1996 | 4632684017.96037
 PERU                      |   1995 | 4628783063.21079
 PERU                      |   1994 | 4626830555.14917
 PERU                      |   1993 | 4618427319.94296
 PERU                      |   1992 |  4641953163.8752
 ROMANIA                   |   1998 | 2743222567.47446
 ROMANIA                   |   1997 | 4687491460.44546
 ROMANIA                   |   1996 |  4696211804.9632
 ROMANIA                   |   1995 | 4695516241.62873
 ROMANIA                   |   1994 | 4676226686.90791
 ROMANIA                   |   1993 | 4658808514.19959
 ROMANIA                   |   1992 | 4689526112.29785
 RUSSIA                    |   1998 | 2721258089.89602
 RUSSIA                    |   1997 |  4659594366.9979
 RUSSIA                    |   1996 |  4691760038.0429
 RUSSIA                    |   1995 | 4671952622.63133
 RUSSIA                    |   1994 | 4678831773.88045
 RUSSIA                    |   1993 | 4663448723.96317
 RUSSIA                    |   1992 | 4682217490.55846
 SAUDI ARABIA              |   1998 | 2737948272.97758
 SAUDI ARABIA              |   1997 | 4672115114.74541
 SAUDI ARABIA              |   1996 | 4677897506.79381
 SAUDI ARABIA              |   1995 | 4672878847.16988
 SAUDI ARABIA              |   1994 | 4672135259.87615
 SAUDI ARABIA              |   1993 | 4697744372.36982
 SAUDI ARABIA              |   1992 |  4652759739.4842
 UNITED KINGDOM            |   1998 | 2751152912.12198
 UNITED KINGDOM            |   1997 |  4692018208.7557
 UNITED KINGDOM            |   1996 | 4703311792.78676
 UNITED KINGDOM            |   1995 | 4713564569.58861
 UNITED KINGDOM            |   1994 | 4689987129.34109
 UNITED KINGDOM            |   1993 | 4678434895.81594
 UNITED KINGDOM            |   1992 | 4701305668.71686
 UNITED STATES             |   1998 |  2751851551.8126
 UNITED STATES             |   1997 | 4668569892.36094
 UNITED STATES             |   1996 | 4669023674.85647
 UNITED STATES             |   1995 | 4658394806.36496
 UNITED STATES             |   1994 | 4686257133.65873
 UNITED STATES             |   1993 | 4659664275.94415
 UNITED STATES             |   1992 | 4686312062.74552
 VIETNAM                   |   1998 | 2746395793.03524
 VIETNAM                   |   1997 | 4678205613.37737
 VIETNAM                   |   1996 |  4699189948.7183
 VIETNAM                   |   1995 | 4682349670.03503
 VIETNAM                   |   1994 | 4704359592.52783
 VIETNAM                   |   1993 | 4701030609.49361
 VIETNAM                   |   1992 | 4700005561.29917
(175 rows)

COMMIT;
COMMIT
