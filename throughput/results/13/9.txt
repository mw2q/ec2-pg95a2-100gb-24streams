BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%chocolate%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2732383692.06869
 ALGERIA                   |   1997 | 4672833631.06815
 ALGERIA                   |   1996 | 4696917497.77647
 ALGERIA                   |   1995 |  4664661489.7854
 ALGERIA                   |   1994 | 4691948932.98746
 ALGERIA                   |   1993 | 4686826708.92066
 ALGERIA                   |   1992 | 4686646311.27626
 ARGENTINA                 |   1998 | 2709980910.74354
 ARGENTINA                 |   1997 | 4631809077.33506
 ARGENTINA                 |   1996 | 4654364073.15808
 ARGENTINA                 |   1995 | 4612202315.14367
 ARGENTINA                 |   1994 | 4616420896.02873
 ARGENTINA                 |   1993 |  4637017218.0279
 ARGENTINA                 |   1992 | 4648105243.90535
 BRAZIL                    |   1998 | 2755849079.90884
 BRAZIL                    |   1997 | 4690837214.36322
 BRAZIL                    |   1996 | 4699382305.16324
 BRAZIL                    |   1995 | 4669498442.92509
 BRAZIL                    |   1994 | 4673546158.31732
 BRAZIL                    |   1993 | 4703524025.41679
 BRAZIL                    |   1992 | 4710888411.78876
 CANADA                    |   1998 | 2747217455.30678
 CANADA                    |   1997 | 4710605298.48894
 CANADA                    |   1996 |  4704768935.1279
 CANADA                    |   1995 |  4702309366.6865
 CANADA                    |   1994 |   4683983546.678
 CANADA                    |   1993 | 4666389049.64617
 CANADA                    |   1992 | 4692952186.08589
 CHINA                     |   1998 | 2723238575.88431
 CHINA                     |   1997 | 4689634108.75629
 CHINA                     |   1996 | 4684009929.03459
 CHINA                     |   1995 |  4670567255.7227
 CHINA                     |   1994 | 4657777589.18583
 CHINA                     |   1993 |  4650591766.8044
 CHINA                     |   1992 | 4676441629.67129
 EGYPT                     |   1998 | 2742071702.22661
 EGYPT                     |   1997 | 4687423886.26819
 EGYPT                     |   1996 | 4707972539.25283
 EGYPT                     |   1995 | 4674893977.93946
 EGYPT                     |   1994 | 4679233173.54029
 EGYPT                     |   1993 | 4696682807.38373
 EGYPT                     |   1992 | 4684015213.71156
 ETHIOPIA                  |   1998 | 2764392294.72099
 ETHIOPIA                  |   1997 | 4725377449.34115
 ETHIOPIA                  |   1996 | 4712168186.19628
 ETHIOPIA                  |   1995 | 4746270248.95356
 ETHIOPIA                  |   1994 | 4725606104.62467
 ETHIOPIA                  |   1993 | 4707087890.55037
 ETHIOPIA                  |   1992 | 4727154349.64884
 FRANCE                    |   1998 |  2740992045.4312
 FRANCE                    |   1997 | 4673021346.82408
 FRANCE                    |   1996 | 4703924538.33003
 FRANCE                    |   1995 | 4671354018.97728
 FRANCE                    |   1994 | 4673260484.26461
 FRANCE                    |   1993 | 4677657468.32733
 FRANCE                    |   1992 | 4690565310.77894
 GERMANY                   |   1998 | 2741476279.27831
 GERMANY                   |   1997 |  4675861277.5202
 GERMANY                   |   1996 | 4701429876.12809
 GERMANY                   |   1995 | 4701857887.63647
 GERMANY                   |   1994 | 4673814438.97916
 GERMANY                   |   1993 | 4700230578.27182
 GERMANY                   |   1992 | 4695396553.23606
 INDIA                     |   1998 | 2751778764.70586
 INDIA                     |   1997 |  4697299470.3349
 INDIA                     |   1996 | 4673180684.58046
 INDIA                     |   1995 | 4673765779.57085
 INDIA                     |   1994 | 4680306271.42828
 INDIA                     |   1993 | 4705371675.01711
 INDIA                     |   1992 | 4700054402.10708
 INDONESIA                 |   1998 | 2716136067.13753
 INDONESIA                 |   1997 | 4628861267.04968
 INDONESIA                 |   1996 | 4634908103.41182
 INDONESIA                 |   1995 | 4622078946.19502
 INDONESIA                 |   1994 | 4644887841.08347
 INDONESIA                 |   1993 | 4672646058.29655
 INDONESIA                 |   1992 | 4659905866.72448
 IRAN                      |   1998 |  2718063126.7549
 IRAN                      |   1997 | 4664051386.00005
 IRAN                      |   1996 | 4668865890.29044
 IRAN                      |   1995 | 4646247608.36091
 IRAN                      |   1994 | 4659977377.91806
 IRAN                      |   1993 | 4653047900.01195
 IRAN                      |   1992 | 4642858177.93254
 IRAQ                      |   1998 | 2712336633.39255
 IRAQ                      |   1997 | 4690356619.84877
 IRAQ                      |   1996 |  4676592223.8746
 IRAQ                      |   1995 | 4669048778.03208
 IRAQ                      |   1994 | 4643946733.45168
 IRAQ                      |   1993 | 4669852738.42335
 IRAQ                      |   1992 | 4675615861.20909
 JAPAN                     |   1998 | 2723171265.49631
 JAPAN                     |   1997 | 4646808586.15341
 JAPAN                     |   1996 | 4648661008.92082
 JAPAN                     |   1995 | 4631408639.88463
 JAPAN                     |   1994 | 4640723588.60798
 JAPAN                     |   1993 | 4641213297.29933
 JAPAN                     |   1992 | 4639361476.59622
 JORDAN                    |   1998 | 2725264103.52412
 JORDAN                    |   1997 | 4643198554.07055
 JORDAN                    |   1996 | 4648718505.79183
 JORDAN                    |   1995 |  4674425676.7064
 JORDAN                    |   1994 | 4654063789.46416
 JORDAN                    |   1993 | 4633756787.91677
 JORDAN                    |   1992 | 4642779297.18369
 KENYA                     |   1998 | 2720300460.98366
 KENYA                     |   1997 | 4612036165.45907
 KENYA                     |   1996 | 4650042908.91406
 KENYA                     |   1995 | 4640984391.64094
 KENYA                     |   1994 | 4675320044.39487
 KENYA                     |   1993 |  4630847003.9022
 KENYA                     |   1992 | 4611309273.38009
 MOROCCO                   |   1998 | 2761698975.28474
 MOROCCO                   |   1997 | 4697245220.81829
 MOROCCO                   |   1996 | 4718150436.56956
 MOROCCO                   |   1995 | 4683828028.60171
 MOROCCO                   |   1994 | 4686413293.95854
 MOROCCO                   |   1993 |  4668999848.3564
 MOROCCO                   |   1992 | 4710401252.49414
 MOZAMBIQUE                |   1998 | 2735694351.57565
 MOZAMBIQUE                |   1997 | 4693901284.21905
 MOZAMBIQUE                |   1996 | 4691525985.90696
 MOZAMBIQUE                |   1995 | 4690140423.92688
 MOZAMBIQUE                |   1994 | 4699285116.04094
 MOZAMBIQUE                |   1993 | 4682424481.21242
 MOZAMBIQUE                |   1992 | 4712254135.98727
 PERU                      |   1998 | 2707857432.89448
 PERU                      |   1997 | 4684752630.34109
 PERU                      |   1996 |  4663969755.8708
 PERU                      |   1995 | 4649635492.01515
 PERU                      |   1994 | 4650392937.73552
 PERU                      |   1993 | 4634385832.43779
 PERU                      |   1992 | 4644694134.56155
 ROMANIA                   |   1998 |  2737394971.9163
 ROMANIA                   |   1997 |  4648651317.9107
 ROMANIA                   |   1996 | 4662611739.61999
 ROMANIA                   |   1995 | 4648239886.76325
 ROMANIA                   |   1994 | 4669193911.02769
 ROMANIA                   |   1993 | 4638122245.51535
 ROMANIA                   |   1992 | 4648683531.28685
 RUSSIA                    |   1998 | 2728149632.85942
 RUSSIA                    |   1997 | 4665567863.37616
 RUSSIA                    |   1996 | 4671134496.49019
 RUSSIA                    |   1995 | 4663415147.13845
 RUSSIA                    |   1994 | 4676838621.28812
 RUSSIA                    |   1993 | 4682179383.40627
 RUSSIA                    |   1992 | 4687405458.46535
 SAUDI ARABIA              |   1998 |  2738754873.1034
 SAUDI ARABIA              |   1997 | 4641617516.41997
 SAUDI ARABIA              |   1996 | 4656436133.07921
 SAUDI ARABIA              |   1995 | 4664023940.82059
 SAUDI ARABIA              |   1994 | 4660333769.86348
 SAUDI ARABIA              |   1993 | 4656558834.65284
 SAUDI ARABIA              |   1992 | 4650627789.05135
 UNITED KINGDOM            |   1998 | 2740528636.10907
 UNITED KINGDOM            |   1997 | 4680154535.22836
 UNITED KINGDOM            |   1996 | 4690662426.25428
 UNITED KINGDOM            |   1995 | 4673689519.58065
 UNITED KINGDOM            |   1994 | 4718406710.10019
 UNITED KINGDOM            |   1993 | 4675812224.17708
 UNITED KINGDOM            |   1992 | 4699534259.41595
 UNITED STATES             |   1998 | 2740098413.05998
 UNITED STATES             |   1997 | 4693140450.49271
 UNITED STATES             |   1996 | 4695233242.21583
 UNITED STATES             |   1995 | 4685375584.65667
 UNITED STATES             |   1994 | 4679059503.60805
 UNITED STATES             |   1993 | 4700632521.74153
 UNITED STATES             |   1992 | 4684964914.36219
 VIETNAM                   |   1998 | 2748042563.33496
 VIETNAM                   |   1997 | 4657129276.85606
 VIETNAM                   |   1996 | 4700625005.77652
 VIETNAM                   |   1995 | 4656266444.80795
 VIETNAM                   |   1994 | 4672966418.77828
 VIETNAM                   |   1993 | 4691483854.64427
 VIETNAM                   |   1992 | 4686666680.01728
(175 rows)

COMMIT;
COMMIT
