BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%green%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2745312784.37752
 ALGERIA                   |   1997 | 4705358544.57314
 ALGERIA                   |   1996 | 4688909184.96188
 ALGERIA                   |   1995 | 4690984195.30347
 ALGERIA                   |   1994 | 4679585856.24727
 ALGERIA                   |   1993 | 4682245478.25628
 ALGERIA                   |   1992 |  4703861174.2198
 ARGENTINA                 |   1998 | 2716927421.12883
 ARGENTINA                 |   1997 |  4646949248.1443
 ARGENTINA                 |   1996 | 4655080506.20613
 ARGENTINA                 |   1995 | 4653943423.62136
 ARGENTINA                 |   1994 | 4646701144.68445
 ARGENTINA                 |   1993 | 4644270361.76932
 ARGENTINA                 |   1992 | 4620385830.24748
 BRAZIL                    |   1998 | 2733277270.10626
 BRAZIL                    |   1997 | 4677403731.05242
 BRAZIL                    |   1996 | 4667113526.17368
 BRAZIL                    |   1995 | 4662990875.40044
 BRAZIL                    |   1994 | 4663928151.19473
 BRAZIL                    |   1993 |   4675526079.478
 BRAZIL                    |   1992 | 4696974467.59274
 CANADA                    |   1998 | 2737213077.21012
 CANADA                    |   1997 | 4680085726.38184
 CANADA                    |   1996 | 4682168117.51443
 CANADA                    |   1995 | 4682542307.64423
 CANADA                    |   1994 |  4663894703.2958
 CANADA                    |   1993 | 4664765018.72648
 CANADA                    |   1992 |   4692829043.067
 CHINA                     |   1998 | 2735311065.22066
 CHINA                     |   1997 | 4683235357.63041
 CHINA                     |   1996 | 4694270701.63264
 CHINA                     |   1995 | 4661148377.67588
 CHINA                     |   1994 | 4668736889.27945
 CHINA                     |   1993 | 4655724347.35237
 CHINA                     |   1992 | 4673077933.38272
 EGYPT                     |   1998 | 2729541274.92473
 EGYPT                     |   1997 |  4644960999.1113
 EGYPT                     |   1996 | 4680986199.22094
 EGYPT                     |   1995 | 4659901288.56363
 EGYPT                     |   1994 | 4639303099.49036
 EGYPT                     |   1993 | 4653590980.31499
 EGYPT                     |   1992 | 4652681903.25922
 ETHIOPIA                  |   1998 | 2771644314.74975
 ETHIOPIA                  |   1997 | 4690650858.69471
 ETHIOPIA                  |   1996 | 4699690447.09169
 ETHIOPIA                  |   1995 | 4711197543.05871
 ETHIOPIA                  |   1994 | 4714045401.13175
 ETHIOPIA                  |   1993 | 4675280602.03917
 ETHIOPIA                  |   1992 | 4710437051.29532
 FRANCE                    |   1998 | 2749541202.32749
 FRANCE                    |   1997 | 4691662246.29135
 FRANCE                    |   1996 | 4721805799.56154
 FRANCE                    |   1995 | 4702252733.22416
 FRANCE                    |   1994 | 4702312169.92642
 FRANCE                    |   1993 | 4712918584.95353
 FRANCE                    |   1992 | 4706903019.82756
 GERMANY                   |   1998 | 2766834533.60984
 GERMANY                   |   1997 | 4702283253.53125
 GERMANY                   |   1996 | 4690834323.53292
 GERMANY                   |   1995 | 4686482721.82756
 GERMANY                   |   1994 | 4661204615.43445
 GERMANY                   |   1993 | 4691280272.66426
 GERMANY                   |   1992 | 4692441592.06141
 INDIA                     |   1998 | 2732911715.89861
 INDIA                     |   1997 | 4678420260.06514
 INDIA                     |   1996 | 4673471997.98133
 INDIA                     |   1995 | 4675500819.87131
 INDIA                     |   1994 | 4678442261.51476
 INDIA                     |   1993 | 4644369996.50976
 INDIA                     |   1992 | 4666585654.59698
 INDONESIA                 |   1998 | 2746826149.23623
 INDONESIA                 |   1997 | 4664805750.37131
 INDONESIA                 |   1996 | 4670571602.91795
 INDONESIA                 |   1995 | 4666312451.09719
 INDONESIA                 |   1994 |  4661197303.6298
 INDONESIA                 |   1993 | 4658656250.17698
 INDONESIA                 |   1992 | 4671366596.42954
 IRAN                      |   1998 |   2722093358.326
 IRAN                      |   1997 | 4610057939.18904
 IRAN                      |   1996 | 4628761277.14044
 IRAN                      |   1995 | 4628131710.13598
 IRAN                      |   1994 | 4611170200.94813
 IRAN                      |   1993 | 4620219151.49376
 IRAN                      |   1992 | 4628968479.65939
 IRAQ                      |   1998 | 2740438114.93168
 IRAQ                      |   1997 | 4665086045.18717
 IRAQ                      |   1996 | 4681734714.06359
 IRAQ                      |   1995 | 4653131478.07733
 IRAQ                      |   1994 | 4686306142.13892
 IRAQ                      |   1993 | 4665375406.70228
 IRAQ                      |   1992 |  4679672073.5766
 JAPAN                     |   1998 | 2724748676.24117
 JAPAN                     |   1997 | 4608812256.52352
 JAPAN                     |   1996 | 4652772278.62694
 JAPAN                     |   1995 | 4662214047.33301
 JAPAN                     |   1994 | 4630827345.95875
 JAPAN                     |   1993 | 4635248896.62305
 JAPAN                     |   1992 | 4655289336.28214
 JORDAN                    |   1998 | 2744829820.70355
 JORDAN                    |   1997 | 4671319302.40781
 JORDAN                    |   1996 | 4669740870.40896
 JORDAN                    |   1995 | 4650395451.54972
 JORDAN                    |   1994 | 4672119544.34247
 JORDAN                    |   1993 | 4674081545.92878
 JORDAN                    |   1992 |  4677302271.4928
 KENYA                     |   1998 |  2717378824.2422
 KENYA                     |   1997 | 4607833353.78703
 KENYA                     |   1996 | 4626958211.97952
 KENYA                     |   1995 | 4609996853.29459
 KENYA                     |   1994 | 4617628462.82909
 KENYA                     |   1993 | 4629732843.53591
 KENYA                     |   1992 | 4637501821.73942
 MOROCCO                   |   1998 | 2729829028.58589
 MOROCCO                   |   1997 | 4678279964.14184
 MOROCCO                   |   1996 | 4691756544.44541
 MOROCCO                   |   1995 | 4670775142.20273
 MOROCCO                   |   1994 | 4679583258.06023
 MOROCCO                   |   1993 | 4660425558.12083
 MOROCCO                   |   1992 | 4675104910.69842
 MOZAMBIQUE                |   1998 | 2746554144.64605
 MOZAMBIQUE                |   1997 | 4659327498.26566
 MOZAMBIQUE                |   1996 | 4680940424.18843
 MOZAMBIQUE                |   1995 | 4682373655.47355
 MOZAMBIQUE                |   1994 | 4651456511.88379
 MOZAMBIQUE                |   1993 | 4677102696.52611
 MOZAMBIQUE                |   1992 | 4701568682.54353
 PERU                      |   1998 | 2701857702.11153
 PERU                      |   1997 | 4625961691.77605
 PERU                      |   1996 | 4655213019.10948
 PERU                      |   1995 | 4651152832.56451
 PERU                      |   1994 | 4641704859.76057
 PERU                      |   1993 | 4629772216.99349
 PERU                      |   1992 | 4630347907.36414
 ROMANIA                   |   1998 | 2731635691.56603
 ROMANIA                   |   1997 |  4661329929.0279
 ROMANIA                   |   1996 | 4692094097.06047
 ROMANIA                   |   1995 | 4682091793.15291
 ROMANIA                   |   1994 |  4658930468.1897
 ROMANIA                   |   1993 | 4671847831.56122
 ROMANIA                   |   1992 |  4661143848.7934
 RUSSIA                    |   1998 | 2738671618.69612
 RUSSIA                    |   1997 | 4700387637.05154
 RUSSIA                    |   1996 | 4695157274.05751
 RUSSIA                    |   1995 | 4673684388.85952
 RUSSIA                    |   1994 | 4686806550.86341
 RUSSIA                    |   1993 |  4678572166.4325
 RUSSIA                    |   1992 | 4684789955.37827
 SAUDI ARABIA              |   1998 | 2721773780.05117
 SAUDI ARABIA              |   1997 | 4646462570.84745
 SAUDI ARABIA              |   1996 | 4681822125.60248
 SAUDI ARABIA              |   1995 | 4660196029.02981
 SAUDI ARABIA              |   1994 | 4668077844.59376
 SAUDI ARABIA              |   1993 | 4648918487.83059
 SAUDI ARABIA              |   1992 | 4668610586.51002
 UNITED KINGDOM            |   1998 | 2757026661.24596
 UNITED KINGDOM            |   1997 |  4688199697.1756
 UNITED KINGDOM            |   1996 | 4724275315.45074
 UNITED KINGDOM            |   1995 | 4692511045.21673
 UNITED KINGDOM            |   1994 | 4715805129.53271
 UNITED KINGDOM            |   1993 | 4691407614.39199
 UNITED KINGDOM            |   1992 | 4723555431.97538
 UNITED STATES             |   1998 | 2744932994.19481
 UNITED STATES             |   1997 | 4654895051.69114
 UNITED STATES             |   1996 | 4669261636.54423
 UNITED STATES             |   1995 | 4658034741.42406
 UNITED STATES             |   1994 | 4669853910.16594
 UNITED STATES             |   1993 | 4679165548.37195
 UNITED STATES             |   1992 | 4706739663.86867
 VIETNAM                   |   1998 | 2741770705.19926
 VIETNAM                   |   1997 | 4660862786.99317
 VIETNAM                   |   1996 |  4690660383.5759
 VIETNAM                   |   1995 | 4692481662.88583
 VIETNAM                   |   1994 |  4702883676.5872
 VIETNAM                   |   1993 | 4710049078.89334
 VIETNAM                   |   1992 |  4682455520.1291
(175 rows)

COMMIT;
COMMIT
