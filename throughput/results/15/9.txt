BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%azure%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2735278268.52802
 ALGERIA                   |   1997 | 4644640831.12685
 ALGERIA                   |   1996 | 4657137438.93324
 ALGERIA                   |   1995 | 4629609499.53336
 ALGERIA                   |   1994 | 4632968282.65164
 ALGERIA                   |   1993 | 4665984995.32773
 ALGERIA                   |   1992 | 4661613574.52318
 ARGENTINA                 |   1998 | 2709898886.23302
 ARGENTINA                 |   1997 |  4660198198.9943
 ARGENTINA                 |   1996 | 4653879272.74761
 ARGENTINA                 |   1995 | 4613615890.59849
 ARGENTINA                 |   1994 | 4624054711.85611
 ARGENTINA                 |   1993 | 4620503764.58234
 ARGENTINA                 |   1992 |   4639562942.424
 BRAZIL                    |   1998 | 2745579127.94113
 BRAZIL                    |   1997 | 4686388472.48263
 BRAZIL                    |   1996 | 4705400441.26396
 BRAZIL                    |   1995 | 4657480518.84668
 BRAZIL                    |   1994 | 4655071622.50158
 BRAZIL                    |   1993 |  4673525715.9798
 BRAZIL                    |   1992 | 4692183330.55887
 CANADA                    |   1998 | 2757353727.39314
 CANADA                    |   1997 | 4714865317.49361
 CANADA                    |   1996 | 4723495744.09103
 CANADA                    |   1995 |  4693939210.1365
 CANADA                    |   1994 | 4680900946.31803
 CANADA                    |   1993 | 4711722785.62365
 CANADA                    |   1992 | 4731466239.64003
 CHINA                     |   1998 | 2738548685.54819
 CHINA                     |   1997 |  4621565466.9606
 CHINA                     |   1996 | 4646939812.28886
 CHINA                     |   1995 | 4635076260.95447
 CHINA                     |   1994 | 4641390484.50467
 CHINA                     |   1993 | 4657292387.57356
 CHINA                     |   1992 | 4658886237.50103
 EGYPT                     |   1998 | 2740171218.96342
 EGYPT                     |   1997 | 4688878621.10166
 EGYPT                     |   1996 | 4677152673.44618
 EGYPT                     |   1995 | 4678476366.95533
 EGYPT                     |   1994 |  4666329522.7799
 EGYPT                     |   1993 |  4703002206.4184
 EGYPT                     |   1992 | 4674152246.38741
 ETHIOPIA                  |   1998 | 2776839274.93375
 ETHIOPIA                  |   1997 |  4706508182.8068
 ETHIOPIA                  |   1996 | 4731479283.12818
 ETHIOPIA                  |   1995 |  4720403443.6065
 ETHIOPIA                  |   1994 | 4709507725.10747
 ETHIOPIA                  |   1993 | 4672182330.93143
 ETHIOPIA                  |   1992 | 4709008297.78708
 FRANCE                    |   1998 | 2755443780.45138
 FRANCE                    |   1997 | 4667290107.50285
 FRANCE                    |   1996 |  4679831474.3231
 FRANCE                    |   1995 | 4666022622.29384
 FRANCE                    |   1994 | 4675471914.56346
 FRANCE                    |   1993 | 4687664957.86165
 FRANCE                    |   1992 | 4712569609.24069
 GERMANY                   |   1998 | 2765912031.37582
 GERMANY                   |   1997 | 4704022760.99086
 GERMANY                   |   1996 | 4703632166.95885
 GERMANY                   |   1995 | 4697797587.59398
 GERMANY                   |   1994 | 4675282242.37593
 GERMANY                   |   1993 | 4714795961.63698
 GERMANY                   |   1992 | 4723830862.75219
 INDIA                     |   1998 | 2755321707.42876
 INDIA                     |   1997 | 4671216810.79986
 INDIA                     |   1996 | 4704188331.72984
 INDIA                     |   1995 | 4685299516.14892
 INDIA                     |   1994 | 4662433314.85884
 INDIA                     |   1993 | 4686388680.22379
 INDIA                     |   1992 | 4712451716.77304
 INDONESIA                 |   1998 | 2750502512.47087
 INDONESIA                 |   1997 | 4671107760.16362
 INDONESIA                 |   1996 |  4680237700.3639
 INDONESIA                 |   1995 | 4681002617.54639
 INDONESIA                 |   1994 |   4636132596.717
 INDONESIA                 |   1993 | 4664746587.88183
 INDONESIA                 |   1992 | 4666870758.32597
 IRAN                      |   1998 | 2734826566.08958
 IRAN                      |   1997 | 4663999292.43141
 IRAN                      |   1996 | 4640729971.44029
 IRAN                      |   1995 | 4653366798.26675
 IRAN                      |   1994 | 4640225364.00333
 IRAN                      |   1993 | 4642085115.66212
 IRAN                      |   1992 | 4634248191.26492
 IRAQ                      |   1998 | 2744730719.57745
 IRAQ                      |   1997 | 4640439848.22875
 IRAQ                      |   1996 | 4688827516.96709
 IRAQ                      |   1995 | 4674197874.95592
 IRAQ                      |   1994 | 4637158604.17745
 IRAQ                      |   1993 | 4671586587.59679
 IRAQ                      |   1992 | 4688440197.31233
 JAPAN                     |   1998 | 2694650735.01614
 JAPAN                     |   1997 | 4632950110.30937
 JAPAN                     |   1996 | 4639751567.13216
 JAPAN                     |   1995 | 4626118237.45853
 JAPAN                     |   1994 |  4638492667.5304
 JAPAN                     |   1993 | 4625479684.41193
 JAPAN                     |   1992 | 4636242314.55152
 JORDAN                    |   1998 |   2724373453.968
 JORDAN                    |   1997 | 4686348407.75913
 JORDAN                    |   1996 | 4705526540.93724
 JORDAN                    |   1995 | 4639998521.71991
 JORDAN                    |   1994 | 4659635683.31345
 JORDAN                    |   1993 | 4646478764.83609
 JORDAN                    |   1992 |  4685945102.8805
 KENYA                     |   1998 | 2722344729.77647
 KENYA                     |   1997 | 4626751363.52794
 KENYA                     |   1996 | 4655787040.26764
 KENYA                     |   1995 | 4659147323.87647
 KENYA                     |   1994 | 4634858339.70775
 KENYA                     |   1993 |  4660350888.2489
 KENYA                     |   1992 | 4628434406.96559
 MOROCCO                   |   1998 |  2743270295.4895
 MOROCCO                   |   1997 |  4695152579.3645
 MOROCCO                   |   1996 | 4696963465.56783
 MOROCCO                   |   1995 | 4650277415.68893
 MOROCCO                   |   1994 | 4698062898.13031
 MOROCCO                   |   1993 | 4660398381.52632
 MOROCCO                   |   1992 | 4707988983.91952
 MOZAMBIQUE                |   1998 | 2739956789.59143
 MOZAMBIQUE                |   1997 | 4683894609.57489
 MOZAMBIQUE                |   1996 | 4691199877.47155
 MOZAMBIQUE                |   1995 | 4692008205.53572
 MOZAMBIQUE                |   1994 |  4654613433.4155
 MOZAMBIQUE                |   1993 | 4658197847.76776
 MOZAMBIQUE                |   1992 | 4696999572.53481
 PERU                      |   1998 | 2725624954.34316
 PERU                      |   1997 | 4654115649.68393
 PERU                      |   1996 | 4653068156.40512
 PERU                      |   1995 | 4648976363.42512
 PERU                      |   1994 | 4651185873.98296
 PERU                      |   1993 | 4656898680.36065
 PERU                      |   1992 | 4655410527.07957
 ROMANIA                   |   1998 | 2753609182.76533
 ROMANIA                   |   1997 | 4704319619.73805
 ROMANIA                   |   1996 | 4719616354.80384
 ROMANIA                   |   1995 | 4706714796.42036
 ROMANIA                   |   1994 | 4713434255.04665
 ROMANIA                   |   1993 | 4670033907.37655
 ROMANIA                   |   1992 | 4706585295.60057
 RUSSIA                    |   1998 | 2741121967.26534
 RUSSIA                    |   1997 | 4671379578.06624
 RUSSIA                    |   1996 | 4682499867.77686
 RUSSIA                    |   1995 | 4693340070.02657
 RUSSIA                    |   1994 | 4673318688.91002
 RUSSIA                    |   1993 |  4686690864.6119
 RUSSIA                    |   1992 | 4677854694.45655
 SAUDI ARABIA              |   1998 | 2730937085.25948
 SAUDI ARABIA              |   1997 | 4657982475.67629
 SAUDI ARABIA              |   1996 | 4656519461.72828
 SAUDI ARABIA              |   1995 | 4661597723.72934
 SAUDI ARABIA              |   1994 | 4679568342.24727
 SAUDI ARABIA              |   1993 | 4655773708.34525
 SAUDI ARABIA              |   1992 | 4654146316.75248
 UNITED KINGDOM            |   1998 | 2747433348.88002
 UNITED KINGDOM            |   1997 | 4703832400.85081
 UNITED KINGDOM            |   1996 |  4718988435.7289
 UNITED KINGDOM            |   1995 | 4697494564.10103
 UNITED KINGDOM            |   1994 | 4707134502.30454
 UNITED KINGDOM            |   1993 | 4696965778.77436
 UNITED KINGDOM            |   1992 | 4702044344.42479
 UNITED STATES             |   1998 | 2722245827.88532
 UNITED STATES             |   1997 | 4697259809.62965
 UNITED STATES             |   1996 | 4700608948.15504
 UNITED STATES             |   1995 | 4662162450.69413
 UNITED STATES             |   1994 | 4692733175.66514
 UNITED STATES             |   1993 | 4673658748.93668
 UNITED STATES             |   1992 | 4668511499.48646
 VIETNAM                   |   1998 | 2738253654.29215
 VIETNAM                   |   1997 | 4662126289.54949
 VIETNAM                   |   1996 | 4696332693.54355
 VIETNAM                   |   1995 | 4654107529.20318
 VIETNAM                   |   1994 | 4685121478.08343
 VIETNAM                   |   1993 | 4675297534.14498
 VIETNAM                   |   1992 | 4675403211.17882
(175 rows)

COMMIT;
COMMIT
