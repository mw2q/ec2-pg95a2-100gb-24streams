BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%violet%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2734859598.58151
 ALGERIA                   |   1997 | 4647157199.60914
 ALGERIA                   |   1996 | 4651246363.65267
 ALGERIA                   |   1995 | 4656178821.59859
 ALGERIA                   |   1994 | 4639075792.32286
 ALGERIA                   |   1993 | 4624867323.71141
 ALGERIA                   |   1992 | 4640955687.67555
 ARGENTINA                 |   1998 | 2711042784.44311
 ARGENTINA                 |   1997 | 4650390929.62325
 ARGENTINA                 |   1996 | 4640367057.42404
 ARGENTINA                 |   1995 | 4643018147.60214
 ARGENTINA                 |   1994 | 4658975679.68286
 ARGENTINA                 |   1993 | 4662261667.57374
 ARGENTINA                 |   1992 | 4665695762.38732
 BRAZIL                    |   1998 | 2767840917.73583
 BRAZIL                    |   1997 | 4665444477.20195
 BRAZIL                    |   1996 |   4682346539.634
 BRAZIL                    |   1995 | 4660805425.27644
 BRAZIL                    |   1994 |  4683086648.9414
 BRAZIL                    |   1993 | 4715590339.74337
 BRAZIL                    |   1992 | 4688106072.00468
 CANADA                    |   1998 | 2751229143.99365
 CANADA                    |   1997 | 4695491033.33396
 CANADA                    |   1996 |  4720316681.8541
 CANADA                    |   1995 | 4704160947.89219
 CANADA                    |   1994 | 4699780717.43783
 CANADA                    |   1993 | 4713268748.38802
 CANADA                    |   1992 | 4719603203.68598
 CHINA                     |   1998 | 2703352441.95112
 CHINA                     |   1997 | 4643923986.79971
 CHINA                     |   1996 | 4673724592.50675
 CHINA                     |   1995 | 4670152358.28967
 CHINA                     |   1994 | 4650551509.56926
 CHINA                     |   1993 |  4644572412.2796
 CHINA                     |   1992 | 4663111143.84082
 EGYPT                     |   1998 | 2724172638.60217
 EGYPT                     |   1997 | 4666406767.00247
 EGYPT                     |   1996 |  4664361590.0061
 EGYPT                     |   1995 | 4679149855.96274
 EGYPT                     |   1994 | 4639203043.44998
 EGYPT                     |   1993 |  4680035723.7998
 EGYPT                     |   1992 | 4686570258.55051
 ETHIOPIA                  |   1998 | 2763210847.49143
 ETHIOPIA                  |   1997 | 4709125455.48288
 ETHIOPIA                  |   1996 | 4741709695.49132
 ETHIOPIA                  |   1995 | 4708773705.51581
 ETHIOPIA                  |   1994 |  4730194265.1805
 ETHIOPIA                  |   1993 | 4711041949.94411
 ETHIOPIA                  |   1992 | 4716525174.98164
 FRANCE                    |   1998 |  2736237616.5131
 FRANCE                    |   1997 | 4662066676.86498
 FRANCE                    |   1996 | 4675981493.73551
 FRANCE                    |   1995 | 4676270496.38258
 FRANCE                    |   1994 | 4666624093.23704
 FRANCE                    |   1993 | 4654240735.91298
 FRANCE                    |   1992 | 4681028379.03298
 GERMANY                   |   1998 | 2782000228.73076
 GERMANY                   |   1997 | 4697138470.50562
 GERMANY                   |   1996 | 4733173595.92285
 GERMANY                   |   1995 | 4717866283.19963
 GERMANY                   |   1994 | 4713222840.87267
 GERMANY                   |   1993 | 4719020329.12165
 GERMANY                   |   1992 | 4734334517.16049
 INDIA                     |   1998 | 2749965808.13132
 INDIA                     |   1997 | 4664483095.06355
 INDIA                     |   1996 | 4665024500.99333
 INDIA                     |   1995 | 4642416488.70385
 INDIA                     |   1994 | 4667834019.38137
 INDIA                     |   1993 | 4668275591.79032
 INDIA                     |   1992 | 4667557546.55899
 INDONESIA                 |   1998 | 2734253582.32128
 INDONESIA                 |   1997 | 4673073529.54324
 INDONESIA                 |   1996 | 4661969483.25956
 INDONESIA                 |   1995 |  4664960758.1355
 INDONESIA                 |   1994 |  4644154872.4879
 INDONESIA                 |   1993 | 4647116139.76333
 INDONESIA                 |   1992 | 4654521284.89804
 IRAN                      |   1998 | 2705810662.93485
 IRAN                      |   1997 | 4648328348.76998
 IRAN                      |   1996 | 4644147073.07426
 IRAN                      |   1995 | 4622479745.39583
 IRAN                      |   1994 | 4620951313.53436
 IRAN                      |   1993 | 4630075023.10103
 IRAN                      |   1992 | 4633574145.14722
 IRAQ                      |   1998 | 2710660427.47248
 IRAQ                      |   1997 | 4647636544.06244
 IRAQ                      |   1996 | 4658026377.18403
 IRAQ                      |   1995 | 4627499570.22571
 IRAQ                      |   1994 | 4658184334.27127
 IRAQ                      |   1993 | 4645989796.73946
 IRAQ                      |   1992 | 4651331131.78175
 JAPAN                     |   1998 | 2723872307.98531
 JAPAN                     |   1997 | 4660156958.01509
 JAPAN                     |   1996 |  4666849789.5992
 JAPAN                     |   1995 | 4658281553.03844
 JAPAN                     |   1994 | 4677760006.82616
 JAPAN                     |   1993 | 4654074219.70289
 JAPAN                     |   1992 | 4668510951.55646
 JORDAN                    |   1998 | 2749719650.94792
 JORDAN                    |   1997 | 4680653056.38793
 JORDAN                    |   1996 | 4700759720.63471
 JORDAN                    |   1995 | 4686203782.79215
 JORDAN                    |   1994 | 4669792412.54513
 JORDAN                    |   1993 | 4692310334.60909
 JORDAN                    |   1992 | 4686122144.29486
 KENYA                     |   1998 | 2716392041.42626
 KENYA                     |   1997 | 4613490814.91345
 KENYA                     |   1996 | 4646260634.51893
 KENYA                     |   1995 | 4614296098.51657
 KENYA                     |   1994 | 4629807570.19966
 KENYA                     |   1993 | 4622290183.08379
 KENYA                     |   1992 | 4628476630.59404
 MOROCCO                   |   1998 | 2736950187.09777
 MOROCCO                   |   1997 | 4691921561.66712
 MOROCCO                   |   1996 | 4711804047.89767
 MOROCCO                   |   1995 | 4666330973.78749
 MOROCCO                   |   1994 |  4651095681.5788
 MOROCCO                   |   1993 | 4666767727.64636
 MOROCCO                   |   1992 | 4706715666.81202
 MOZAMBIQUE                |   1998 | 2746612706.31838
 MOZAMBIQUE                |   1997 | 4676511856.91439
 MOZAMBIQUE                |   1996 |  4690352483.0027
 MOZAMBIQUE                |   1995 | 4647248589.57028
 MOZAMBIQUE                |   1994 | 4658374001.91959
 MOZAMBIQUE                |   1993 | 4662973489.72834
 MOZAMBIQUE                |   1992 | 4688150724.11665
 PERU                      |   1998 | 2706715185.23014
 PERU                      |   1997 | 4617276495.47949
 PERU                      |   1996 | 4655062878.54049
 PERU                      |   1995 | 4626024310.11755
 PERU                      |   1994 | 4631187588.19783
 PERU                      |   1993 | 4636991813.47105
 PERU                      |   1992 | 4659267217.11751
 ROMANIA                   |   1998 | 2743288677.17171
 ROMANIA                   |   1997 |  4702155940.3478
 ROMANIA                   |   1996 | 4705165656.09318
 ROMANIA                   |   1995 |  4681095514.0283
 ROMANIA                   |   1994 |  4710529601.6321
 ROMANIA                   |   1993 | 4705155769.40574
 ROMANIA                   |   1992 | 4712625639.23965
 RUSSIA                    |   1998 | 2735030957.32506
 RUSSIA                    |   1997 | 4665846528.80437
 RUSSIA                    |   1996 | 4675237408.12338
 RUSSIA                    |   1995 | 4655025072.43378
 RUSSIA                    |   1994 | 4671700752.04284
 RUSSIA                    |   1993 | 4646577091.34717
 RUSSIA                    |   1992 | 4660211640.41828
 SAUDI ARABIA              |   1998 | 2752443191.72145
 SAUDI ARABIA              |   1997 | 4677898744.54498
 SAUDI ARABIA              |   1996 | 4675987627.43438
 SAUDI ARABIA              |   1995 | 4680827875.34672
 SAUDI ARABIA              |   1994 | 4655360045.54656
 SAUDI ARABIA              |   1993 | 4660030680.82696
 SAUDI ARABIA              |   1992 | 4692881321.56676
 UNITED KINGDOM            |   1998 | 2746182476.43704
 UNITED KINGDOM            |   1997 | 4726240290.75706
 UNITED KINGDOM            |   1996 | 4722176083.39039
 UNITED KINGDOM            |   1995 | 4711020071.72602
 UNITED KINGDOM            |   1994 | 4737224793.72453
 UNITED KINGDOM            |   1993 | 4678838107.93368
 UNITED KINGDOM            |   1992 | 4741569842.10325
 UNITED STATES             |   1998 | 2734991140.41536
 UNITED STATES             |   1997 | 4669926500.81687
 UNITED STATES             |   1996 | 4699463578.83344
 UNITED STATES             |   1995 | 4656595756.08211
 UNITED STATES             |   1994 | 4678319761.11456
 UNITED STATES             |   1993 | 4670583319.75877
 UNITED STATES             |   1992 | 4679108105.35059
 VIETNAM                   |   1998 | 2753206026.31772
 VIETNAM                   |   1997 | 4687781943.92898
 VIETNAM                   |   1996 | 4693154357.02203
 VIETNAM                   |   1995 | 4678636252.76747
 VIETNAM                   |   1994 | 4709526710.28172
 VIETNAM                   |   1993 | 4698503328.18029
 VIETNAM                   |   1992 | 4698773128.03725
(175 rows)

COMMIT;
COMMIT
