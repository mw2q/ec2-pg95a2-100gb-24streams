BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%khaki%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2728311475.66158
 ALGERIA                   |   1997 | 4646530497.76995
 ALGERIA                   |   1996 | 4671026055.47122
 ALGERIA                   |   1995 | 4679955907.10125
 ALGERIA                   |   1994 |  4667155451.1842
 ALGERIA                   |   1993 | 4654303034.21634
 ALGERIA                   |   1992 | 4666963811.22444
 ARGENTINA                 |   1998 |  2721475879.7874
 ARGENTINA                 |   1997 | 4653146508.92433
 ARGENTINA                 |   1996 | 4676832503.82813
 ARGENTINA                 |   1995 |   4638548217.568
 ARGENTINA                 |   1994 | 4638871995.76192
 ARGENTINA                 |   1993 | 4652109200.80443
 ARGENTINA                 |   1992 | 4652436423.07338
 BRAZIL                    |   1998 | 2744622999.81102
 BRAZIL                    |   1997 | 4702313181.23297
 BRAZIL                    |   1996 | 4685469022.26648
 BRAZIL                    |   1995 |  4691278770.3003
 BRAZIL                    |   1994 | 4672236548.18612
 BRAZIL                    |   1993 | 4691756960.16786
 BRAZIL                    |   1992 | 4677595748.37564
 CANADA                    |   1998 | 2741759231.15608
 CANADA                    |   1997 | 4675919638.35665
 CANADA                    |   1996 |  4662255873.3814
 CANADA                    |   1995 | 4665633829.70012
 CANADA                    |   1994 | 4670243854.04871
 CANADA                    |   1993 | 4658758463.24304
 CANADA                    |   1992 | 4663459170.31063
 CHINA                     |   1998 |  2746011370.4665
 CHINA                     |   1997 |  4680089810.7719
 CHINA                     |   1996 | 4686269397.24109
 CHINA                     |   1995 | 4645967670.84692
 CHINA                     |   1994 | 4662162945.78211
 CHINA                     |   1993 |  4683074885.6168
 CHINA                     |   1992 | 4687480157.97286
 EGYPT                     |   1998 | 2730457435.42291
 EGYPT                     |   1997 | 4686910511.23374
 EGYPT                     |   1996 | 4688710795.92064
 EGYPT                     |   1995 | 4679623248.06249
 EGYPT                     |   1994 | 4680324430.30404
 EGYPT                     |   1993 | 4668634380.88494
 EGYPT                     |   1992 | 4693277705.86336
 ETHIOPIA                  |   1998 | 2778658132.93481
 ETHIOPIA                  |   1997 | 4728931638.42574
 ETHIOPIA                  |   1996 | 4740276974.22249
 ETHIOPIA                  |   1995 | 4735691680.75377
 ETHIOPIA                  |   1994 | 4745167611.25096
 ETHIOPIA                  |   1993 | 4739573769.25513
 ETHIOPIA                  |   1992 | 4772771045.84232
 FRANCE                    |   1998 |   2736051009.466
 FRANCE                    |   1997 | 4709403986.16515
 FRANCE                    |   1996 | 4737747252.59622
 FRANCE                    |   1995 | 4679835831.59394
 FRANCE                    |   1994 | 4685762036.12262
 FRANCE                    |   1993 | 4670896118.37878
 FRANCE                    |   1992 | 4686910029.98384
 GERMANY                   |   1998 | 2756814279.16503
 GERMANY                   |   1997 |  4698532546.8553
 GERMANY                   |   1996 | 4685069581.34859
 GERMANY                   |   1995 |  4690045391.0681
 GERMANY                   |   1994 | 4680683087.93913
 GERMANY                   |   1993 | 4674581431.32494
 GERMANY                   |   1992 | 4700894581.03457
 INDIA                     |   1998 | 2736117992.12166
 INDIA                     |   1997 | 4672014610.33205
 INDIA                     |   1996 | 4686043722.41065
 INDIA                     |   1995 | 4643406225.11295
 INDIA                     |   1994 | 4656137174.51141
 INDIA                     |   1993 | 4663212915.15572
 INDIA                     |   1992 | 4682672884.63432
 INDONESIA                 |   1998 | 2732435596.00528
 INDONESIA                 |   1997 | 4625193388.48169
 INDONESIA                 |   1996 | 4653216797.89351
 INDONESIA                 |   1995 | 4625423158.27894
 INDONESIA                 |   1994 | 4641146122.09309
 INDONESIA                 |   1993 | 4633149092.17283
 INDONESIA                 |   1992 | 4662022634.37961
 IRAN                      |   1998 | 2721242834.64511
 IRAN                      |   1997 | 4660333630.95184
 IRAN                      |   1996 | 4654368768.53467
 IRAN                      |   1995 | 4635072852.49269
 IRAN                      |   1994 | 4649403907.53031
 IRAN                      |   1993 | 4646572672.86638
 IRAN                      |   1992 | 4654129331.45745
 IRAQ                      |   1998 | 2758304394.90691
 IRAQ                      |   1997 | 4677803902.95998
 IRAQ                      |   1996 | 4665176289.62492
 IRAQ                      |   1995 |  4664364946.1979
 IRAQ                      |   1994 | 4657866586.80813
 IRAQ                      |   1993 | 4670009656.26629
 IRAQ                      |   1992 | 4674846992.12426
 JAPAN                     |   1998 | 2696682414.99298
 JAPAN                     |   1997 | 4607370176.35863
 JAPAN                     |   1996 |  4626328546.1187
 JAPAN                     |   1995 | 4599863432.77306
 JAPAN                     |   1994 | 4604312076.39108
 JAPAN                     |   1993 | 4603575571.40778
 JAPAN                     |   1992 | 4614503098.62097
 JORDAN                    |   1998 | 2736115593.49761
 JORDAN                    |   1997 | 4658150542.24616
 JORDAN                    |   1996 | 4679847616.66565
 JORDAN                    |   1995 | 4675112583.33178
 JORDAN                    |   1994 | 4681625979.19147
 JORDAN                    |   1993 | 4669797819.42545
 JORDAN                    |   1992 | 4669675490.18405
 KENYA                     |   1998 | 2697621007.73863
 KENYA                     |   1997 | 4606566444.47074
 KENYA                     |   1996 | 4623212013.72865
 KENYA                     |   1995 | 4624271083.03609
 KENYA                     |   1994 | 4623696693.75802
 KENYA                     |   1993 | 4624656564.63372
 KENYA                     |   1992 | 4618100996.43647
 MOROCCO                   |   1998 | 2778583348.17065
 MOROCCO                   |   1997 | 4707906064.12673
 MOROCCO                   |   1996 |  4717500000.4669
 MOROCCO                   |   1995 | 4675160540.89745
 MOROCCO                   |   1994 | 4706555061.89242
 MOROCCO                   |   1993 | 4701445387.30527
 MOROCCO                   |   1992 | 4717027505.06227
 MOZAMBIQUE                |   1998 | 2733313880.74683
 MOZAMBIQUE                |   1997 |  4660018447.4006
 MOZAMBIQUE                |   1996 | 4669893645.48591
 MOZAMBIQUE                |   1995 | 4664060625.97271
 MOZAMBIQUE                |   1994 | 4645144234.96907
 MOZAMBIQUE                |   1993 | 4661977560.18306
 MOZAMBIQUE                |   1992 | 4653613062.60941
 PERU                      |   1998 | 2706357646.87296
 PERU                      |   1997 | 4609061347.96387
 PERU                      |   1996 | 4617471210.16931
 PERU                      |   1995 | 4628586283.81887
 PERU                      |   1994 | 4666135684.24404
 PERU                      |   1993 |   4614803610.145
 PERU                      |   1992 | 4635546707.60202
 ROMANIA                   |   1998 | 2737454862.50253
 ROMANIA                   |   1997 | 4665880227.21637
 ROMANIA                   |   1996 | 4687062835.09507
 ROMANIA                   |   1995 | 4665062683.77358
 ROMANIA                   |   1994 | 4661280688.12363
 ROMANIA                   |   1993 | 4664398329.82522
 ROMANIA                   |   1992 | 4684516280.62702
 RUSSIA                    |   1998 | 2746605663.62156
 RUSSIA                    |   1997 | 4673820562.20762
 RUSSIA                    |   1996 | 4686023799.67967
 RUSSIA                    |   1995 | 4688653832.52551
 RUSSIA                    |   1994 | 4668479871.96873
 RUSSIA                    |   1993 |  4662268670.5957
 RUSSIA                    |   1992 | 4682249158.34064
 SAUDI ARABIA              |   1998 | 2733357670.57287
 SAUDI ARABIA              |   1997 | 4670870939.11317
 SAUDI ARABIA              |   1996 | 4682634032.60046
 SAUDI ARABIA              |   1995 | 4667601801.58084
 SAUDI ARABIA              |   1994 | 4664750774.67519
 SAUDI ARABIA              |   1993 | 4687547330.57179
 SAUDI ARABIA              |   1992 | 4679218413.08084
 UNITED KINGDOM            |   1998 | 2738978042.67963
 UNITED KINGDOM            |   1997 | 4677556943.91677
 UNITED KINGDOM            |   1996 | 4682843950.79087
 UNITED KINGDOM            |   1995 | 4691115744.12379
 UNITED KINGDOM            |   1994 | 4718822497.70636
 UNITED KINGDOM            |   1993 | 4676939722.73608
 UNITED KINGDOM            |   1992 | 4709352837.14794
 UNITED STATES             |   1998 | 2731939006.40624
 UNITED STATES             |   1997 | 4704837451.04471
 UNITED STATES             |   1996 | 4691731035.12317
 UNITED STATES             |   1995 | 4693014212.22337
 UNITED STATES             |   1994 | 4685070642.18536
 UNITED STATES             |   1993 | 4704737953.75493
 UNITED STATES             |   1992 | 4709393890.63336
 VIETNAM                   |   1998 | 2752621981.22548
 VIETNAM                   |   1997 | 4654514073.54757
 VIETNAM                   |   1996 | 4678165799.68642
 VIETNAM                   |   1995 | 4677011368.66984
 VIETNAM                   |   1994 | 4691268838.72627
 VIETNAM                   |   1993 | 4671999661.10428
 VIETNAM                   |   1992 | 4683751285.65542
(175 rows)

COMMIT;
COMMIT
