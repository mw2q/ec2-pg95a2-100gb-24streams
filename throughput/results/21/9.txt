BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%orchid%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2737662322.69461
 ALGERIA                   |   1997 | 4640545760.97397
 ALGERIA                   |   1996 |  4652024762.5492
 ALGERIA                   |   1995 | 4659471834.94529
 ALGERIA                   |   1994 | 4682435936.60653
 ALGERIA                   |   1993 | 4649374681.93944
 ALGERIA                   |   1992 | 4631363499.89674
 ARGENTINA                 |   1998 | 2718412495.47335
 ARGENTINA                 |   1997 |  4641985061.0937
 ARGENTINA                 |   1996 | 4653280621.43805
 ARGENTINA                 |   1995 |  4615802224.0963
 ARGENTINA                 |   1994 | 4617076846.30404
 ARGENTINA                 |   1993 | 4629517555.01359
 ARGENTINA                 |   1992 | 4653594536.52664
 BRAZIL                    |   1998 | 2733304294.25932
 BRAZIL                    |   1997 | 4647899250.89466
 BRAZIL                    |   1996 | 4694816131.71463
 BRAZIL                    |   1995 | 4686437559.50816
 BRAZIL                    |   1994 | 4682702769.00214
 BRAZIL                    |   1993 | 4693157714.92816
 BRAZIL                    |   1992 | 4696962012.94017
 CANADA                    |   1998 | 2747032238.46145
 CANADA                    |   1997 | 4687450698.16942
 CANADA                    |   1996 | 4697695668.35557
 CANADA                    |   1995 | 4688271574.56249
 CANADA                    |   1994 | 4672260055.92088
 CANADA                    |   1993 | 4697183495.43673
 CANADA                    |   1992 | 4689744178.52747
 CHINA                     |   1998 | 2700323799.95458
 CHINA                     |   1997 | 4644582644.62806
 CHINA                     |   1996 | 4673856883.69427
 CHINA                     |   1995 | 4622683868.05572
 CHINA                     |   1994 |  4638784342.6144
 CHINA                     |   1993 | 4633301989.06357
 CHINA                     |   1992 | 4621632401.81061
 EGYPT                     |   1998 | 2734879331.22639
 EGYPT                     |   1997 | 4650100716.55513
 EGYPT                     |   1996 | 4668487814.08457
 EGYPT                     |   1995 | 4667736998.02668
 EGYPT                     |   1994 |  4667682733.3955
 EGYPT                     |   1993 |    4685743134.33
 EGYPT                     |   1992 | 4683945906.68467
 ETHIOPIA                  |   1998 | 2763840033.84853
 ETHIOPIA                  |   1997 | 4694013281.48977
 ETHIOPIA                  |   1996 |  4727437255.9347
 ETHIOPIA                  |   1995 | 4711663038.87575
 ETHIOPIA                  |   1994 | 4717455104.43557
 ETHIOPIA                  |   1993 | 4706389371.50593
 ETHIOPIA                  |   1992 | 4736185881.52534
 FRANCE                    |   1998 | 2738524448.21654
 FRANCE                    |   1997 | 4663277227.43156
 FRANCE                    |   1996 | 4653263349.68071
 FRANCE                    |   1995 | 4664493292.84422
 FRANCE                    |   1994 | 4653046467.33389
 FRANCE                    |   1993 | 4628491888.48232
 FRANCE                    |   1992 | 4680388985.62785
 GERMANY                   |   1998 | 2770011209.08565
 GERMANY                   |   1997 | 4654168466.24331
 GERMANY                   |   1996 |   4682758238.054
 GERMANY                   |   1995 | 4667036792.82133
 GERMANY                   |   1994 | 4660317426.96212
 GERMANY                   |   1993 | 4674723397.31283
 GERMANY                   |   1992 | 4692030481.85785
 INDIA                     |   1998 | 2731450375.31765
 INDIA                     |   1997 | 4660037133.42575
 INDIA                     |   1996 |  4677529580.6054
 INDIA                     |   1995 |  4637414762.2817
 INDIA                     |   1994 | 4680750044.14041
 INDIA                     |   1993 | 4659043743.63495
 INDIA                     |   1992 | 4648603618.20094
 INDONESIA                 |   1998 | 2715008543.67414
 INDONESIA                 |   1997 |  4637552617.8002
 INDONESIA                 |   1996 | 4628336243.32211
 INDONESIA                 |   1995 | 4626940532.09146
 INDONESIA                 |   1994 | 4650294655.06934
 INDONESIA                 |   1993 | 4637804406.30361
 INDONESIA                 |   1992 |  4648695431.3831
 IRAN                      |   1998 |  2708033995.7359
 IRAN                      |   1997 | 4605062924.97538
 IRAN                      |   1996 | 4631983250.28495
 IRAN                      |   1995 | 4624235530.55507
 IRAN                      |   1994 | 4605605331.17943
 IRAN                      |   1993 | 4611011284.95711
 IRAN                      |   1992 | 4595430140.25752
 IRAQ                      |   1998 | 2714858123.26963
 IRAQ                      |   1997 | 4637783837.55787
 IRAQ                      |   1996 | 4674759085.67156
 IRAQ                      |   1995 | 4663070310.09865
 IRAQ                      |   1994 | 4631662010.11271
 IRAQ                      |   1993 | 4647154162.37605
 IRAQ                      |   1992 | 4676767732.32821
 JAPAN                     |   1998 | 2717266459.39651
 JAPAN                     |   1997 |  4619411856.8629
 JAPAN                     |   1996 | 4658720804.71608
 JAPAN                     |   1995 | 4621038067.80883
 JAPAN                     |   1994 | 4649247352.44841
 JAPAN                     |   1993 | 4617028502.26556
 JAPAN                     |   1992 | 4636947800.09256
 JORDAN                    |   1998 | 2740150825.25498
 JORDAN                    |   1997 | 4640928001.99036
 JORDAN                    |   1996 | 4669028079.82989
 JORDAN                    |   1995 | 4647625754.71062
 JORDAN                    |   1994 | 4654321379.64004
 JORDAN                    |   1993 | 4645160367.23552
 JORDAN                    |   1992 | 4668355056.36951
 KENYA                     |   1998 | 2723870907.46787
 KENYA                     |   1997 | 4657516445.26779
 KENYA                     |   1996 | 4673776167.63806
 KENYA                     |   1995 | 4656620295.44282
 KENYA                     |   1994 | 4639472734.35775
 KENYA                     |   1993 | 4647990041.29957
 KENYA                     |   1992 | 4625209146.16282
 MOROCCO                   |   1998 | 2757051452.73108
 MOROCCO                   |   1997 |   4683375281.669
 MOROCCO                   |   1996 | 4696283276.24466
 MOROCCO                   |   1995 | 4664456104.48005
 MOROCCO                   |   1994 | 4687059032.97044
 MOROCCO                   |   1993 | 4708321685.92175
 MOROCCO                   |   1992 | 4709161307.56887
 MOZAMBIQUE                |   1998 |  2718823333.8052
 MOZAMBIQUE                |   1997 | 4663365227.81432
 MOZAMBIQUE                |   1996 | 4665088297.01398
 MOZAMBIQUE                |   1995 | 4684571053.55529
 MOZAMBIQUE                |   1994 |  4628316445.8856
 MOZAMBIQUE                |   1993 | 4647007633.43431
 MOZAMBIQUE                |   1992 | 4668682813.27366
 PERU                      |   1998 | 2687811418.92383
 PERU                      |   1997 | 4592520251.44019
 PERU                      |   1996 | 4628092606.30539
 PERU                      |   1995 | 4584103586.82673
 PERU                      |   1994 | 4602356048.33258
 PERU                      |   1993 | 4602525651.02315
 PERU                      |   1992 | 4655317136.38621
 ROMANIA                   |   1998 |  2736187162.7529
 ROMANIA                   |   1997 | 4673282227.03402
 ROMANIA                   |   1996 | 4680376519.39701
 ROMANIA                   |   1995 | 4655772381.39387
 ROMANIA                   |   1994 | 4657874321.91641
 ROMANIA                   |   1993 | 4667179527.12876
 ROMANIA                   |   1992 | 4674131426.78833
 RUSSIA                    |   1998 | 2708400467.10317
 RUSSIA                    |   1997 | 4648111281.28714
 RUSSIA                    |   1996 | 4656387915.71812
 RUSSIA                    |   1995 | 4672726540.26325
 RUSSIA                    |   1994 |  4651922979.9142
 RUSSIA                    |   1993 | 4643106005.49445
 RUSSIA                    |   1992 | 4672252393.69869
 SAUDI ARABIA              |   1998 | 2720853466.57455
 SAUDI ARABIA              |   1997 | 4662020238.87804
 SAUDI ARABIA              |   1996 | 4681671457.83977
 SAUDI ARABIA              |   1995 | 4641289695.39213
 SAUDI ARABIA              |   1994 | 4657511905.18529
 SAUDI ARABIA              |   1993 |   4638039172.582
 SAUDI ARABIA              |   1992 | 4667426769.26798
 UNITED KINGDOM            |   1998 | 2745868278.19313
 UNITED KINGDOM            |   1997 | 4686796990.02235
 UNITED KINGDOM            |   1996 | 4707214695.55256
 UNITED KINGDOM            |   1995 | 4687859182.36453
 UNITED KINGDOM            |   1994 | 4675232848.03974
 UNITED KINGDOM            |   1993 | 4673944520.57524
 UNITED KINGDOM            |   1992 |  4674322732.9225
 UNITED STATES             |   1998 | 2749967316.28863
 UNITED STATES             |   1997 | 4681335601.60107
 UNITED STATES             |   1996 | 4701632031.94209
 UNITED STATES             |   1995 | 4669739290.60421
 UNITED STATES             |   1994 | 4701881594.16971
 UNITED STATES             |   1993 | 4675400215.93028
 UNITED STATES             |   1992 | 4680550556.96031
 VIETNAM                   |   1998 |  2746087093.4928
 VIETNAM                   |   1997 | 4669759363.71229
 VIETNAM                   |   1996 | 4717452863.82959
 VIETNAM                   |   1995 |  4676332246.2783
 VIETNAM                   |   1994 | 4657498770.66407
 VIETNAM                   |   1993 | 4659591575.40349
 VIETNAM                   |   1992 | 4676566955.29891
(175 rows)

COMMIT;
COMMIT
