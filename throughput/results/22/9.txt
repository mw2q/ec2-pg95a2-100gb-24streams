BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%misty%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2727671379.79235
 ALGERIA                   |   1997 |  4674514531.4096
 ALGERIA                   |   1996 | 4683537693.29243
 ALGERIA                   |   1995 |  4681477555.6142
 ALGERIA                   |   1994 |  4675876322.7495
 ALGERIA                   |   1993 | 4671633651.72785
 ALGERIA                   |   1992 | 4683788284.55186
 ARGENTINA                 |   1998 | 2696523601.46765
 ARGENTINA                 |   1997 | 4650892012.28441
 ARGENTINA                 |   1996 | 4609104199.11903
 ARGENTINA                 |   1995 | 4616507717.90882
 ARGENTINA                 |   1994 | 4626401895.87729
 ARGENTINA                 |   1993 | 4617443028.18927
 ARGENTINA                 |   1992 | 4651944598.97076
 BRAZIL                    |   1998 | 2743639668.12539
 BRAZIL                    |   1997 | 4704530876.43787
 BRAZIL                    |   1996 | 4699646816.62286
 BRAZIL                    |   1995 | 4676145854.24729
 BRAZIL                    |   1994 |   4657172701.121
 BRAZIL                    |   1993 | 4666201484.51125
 BRAZIL                    |   1992 | 4688709841.08993
 CANADA                    |   1998 | 2730859830.39303
 CANADA                    |   1997 | 4691029888.11578
 CANADA                    |   1996 | 4685155502.65002
 CANADA                    |   1995 | 4687936458.85553
 CANADA                    |   1994 | 4691769192.27889
 CANADA                    |   1993 | 4670889299.95854
 CANADA                    |   1992 | 4688135982.07375
 CHINA                     |   1998 | 2727538868.90197
 CHINA                     |   1997 | 4652868863.56976
 CHINA                     |   1996 | 4655086123.80074
 CHINA                     |   1995 | 4680334132.26052
 CHINA                     |   1994 |  4664033056.4719
 CHINA                     |   1993 | 4674993990.18841
 CHINA                     |   1992 | 4653754676.94764
 EGYPT                     |   1998 | 2718873388.93022
 EGYPT                     |   1997 | 4669545934.03364
 EGYPT                     |   1996 |  4685646681.2237
 EGYPT                     |   1995 | 4653562638.04799
 EGYPT                     |   1994 | 4639531883.38366
 EGYPT                     |   1993 | 4666855134.30963
 EGYPT                     |   1992 | 4673697394.03215
 ETHIOPIA                  |   1998 | 2772938752.06879
 ETHIOPIA                  |   1997 | 4732342060.38782
 ETHIOPIA                  |   1996 | 4739810407.60394
 ETHIOPIA                  |   1995 | 4719241449.77986
 ETHIOPIA                  |   1994 | 4721221405.30974
 ETHIOPIA                  |   1993 | 4714272430.44462
 ETHIOPIA                  |   1992 | 4705459506.54322
 FRANCE                    |   1998 | 2735444642.79078
 FRANCE                    |   1997 | 4674998884.19777
 FRANCE                    |   1996 | 4702815657.64492
 FRANCE                    |   1995 | 4663020029.17634
 FRANCE                    |   1994 | 4656287831.52434
 FRANCE                    |   1993 | 4680596424.11819
 FRANCE                    |   1992 | 4669926621.56338
 GERMANY                   |   1998 | 2739825171.06455
 GERMANY                   |   1997 | 4711392603.54954
 GERMANY                   |   1996 | 4693710799.17985
 GERMANY                   |   1995 | 4684368017.12192
 GERMANY                   |   1994 | 4676174638.33746
 GERMANY                   |   1993 | 4658305815.98562
 GERMANY                   |   1992 | 4685847706.97014
 INDIA                     |   1998 | 2709571221.42853
 INDIA                     |   1997 | 4672403490.71996
 INDIA                     |   1996 | 4684640602.12018
 INDIA                     |   1995 | 4658997705.86027
 INDIA                     |   1994 | 4662145852.34224
 INDIA                     |   1993 | 4653033178.20144
 INDIA                     |   1992 | 4677295431.75904
 INDONESIA                 |   1998 | 2727749651.84895
 INDONESIA                 |   1997 |  4640821924.9095
 INDONESIA                 |   1996 | 4623523126.69929
 INDONESIA                 |   1995 | 4638737266.21547
 INDONESIA                 |   1994 | 4660373860.38696
 INDONESIA                 |   1993 | 4652488836.06902
 INDONESIA                 |   1992 | 4642390351.10767
 IRAN                      |   1998 | 2725991525.60516
 IRAN                      |   1997 | 4630864861.08484
 IRAN                      |   1996 | 4636643804.55131
 IRAN                      |   1995 | 4625726421.29741
 IRAN                      |   1994 | 4609576527.24454
 IRAN                      |   1993 | 4618369104.65562
 IRAN                      |   1992 | 4624002518.89913
 IRAQ                      |   1998 | 2724001336.38664
 IRAQ                      |   1997 | 4611350223.41484
 IRAQ                      |   1996 |  4636833189.6389
 IRAQ                      |   1995 | 4612591863.59833
 IRAQ                      |   1994 | 4628879597.15141
 IRAQ                      |   1993 | 4623614279.70428
 IRAQ                      |   1992 | 4648505844.63044
 JAPAN                     |   1998 | 2732294200.49116
 JAPAN                     |   1997 | 4663494621.68828
 JAPAN                     |   1996 | 4697358050.35415
 JAPAN                     |   1995 | 4666959250.13519
 JAPAN                     |   1994 | 4669198713.19771
 JAPAN                     |   1993 | 4648999142.61333
 JAPAN                     |   1992 | 4678518858.68018
 JORDAN                    |   1998 | 2735852494.33575
 JORDAN                    |   1997 | 4662223939.25613
 JORDAN                    |   1996 | 4683694642.88121
 JORDAN                    |   1995 | 4659106708.60718
 JORDAN                    |   1994 | 4663021854.85643
 JORDAN                    |   1993 | 4659892151.03949
 JORDAN                    |   1992 | 4667984610.69364
 KENYA                     |   1998 | 2701920760.74139
 KENYA                     |   1997 |  4595607176.0431
 KENYA                     |   1996 | 4619974022.68497
 KENYA                     |   1995 | 4608162653.21819
 KENYA                     |   1994 | 4602480256.77402
 KENYA                     |   1993 | 4597346907.90416
 KENYA                     |   1992 | 4619077294.87912
 MOROCCO                   |   1998 | 2747334312.55148
 MOROCCO                   |   1997 | 4686784672.49795
 MOROCCO                   |   1996 | 4689984821.45664
 MOROCCO                   |   1995 |  4706073825.8568
 MOROCCO                   |   1994 | 4672822584.95094
 MOROCCO                   |   1993 | 4689923087.61985
 MOROCCO                   |   1992 | 4693379598.79688
 MOZAMBIQUE                |   1998 | 2751508698.27708
 MOZAMBIQUE                |   1997 | 4650271097.63317
 MOZAMBIQUE                |   1996 | 4675407914.96968
 MOZAMBIQUE                |   1995 | 4644176702.17959
 MOZAMBIQUE                |   1994 | 4639449100.89304
 MOZAMBIQUE                |   1993 | 4636695370.02614
 MOZAMBIQUE                |   1992 | 4651069270.92797
 PERU                      |   1998 |  2714508659.9163
 PERU                      |   1997 | 4643393033.42724
 PERU                      |   1996 |  4649734441.7411
 PERU                      |   1995 |  4618438191.6556
 PERU                      |   1994 | 4645819359.40626
 PERU                      |   1993 | 4633271537.72489
 PERU                      |   1992 |  4657562219.8487
 ROMANIA                   |   1998 | 2734996292.37087
 ROMANIA                   |   1997 | 4671378141.12489
 ROMANIA                   |   1996 | 4687887414.17945
 ROMANIA                   |   1995 | 4666983178.70343
 ROMANIA                   |   1994 | 4673923745.83526
 ROMANIA                   |   1993 | 4667093877.27573
 ROMANIA                   |   1992 |  4674198470.0726
 RUSSIA                    |   1998 | 2708336393.84439
 RUSSIA                    |   1997 | 4685999994.06529
 RUSSIA                    |   1996 | 4668625105.89509
 RUSSIA                    |   1995 | 4665883614.63546
 RUSSIA                    |   1994 | 4646884332.80824
 RUSSIA                    |   1993 | 4655402469.24197
 RUSSIA                    |   1992 | 4681139216.76019
 SAUDI ARABIA              |   1998 |   2723713939.248
 SAUDI ARABIA              |   1997 | 4623159528.31758
 SAUDI ARABIA              |   1996 | 4647226996.14352
 SAUDI ARABIA              |   1995 | 4651701515.00888
 SAUDI ARABIA              |   1994 | 4644522310.96077
 SAUDI ARABIA              |   1993 | 4643508253.63515
 SAUDI ARABIA              |   1992 | 4667916361.77232
 UNITED KINGDOM            |   1998 | 2765216301.06834
 UNITED KINGDOM            |   1997 | 4688136766.87423
 UNITED KINGDOM            |   1996 | 4724072149.58317
 UNITED KINGDOM            |   1995 | 4720584333.40924
 UNITED KINGDOM            |   1994 | 4715052535.51519
 UNITED KINGDOM            |   1993 | 4692596961.73142
 UNITED KINGDOM            |   1992 | 4731989533.28362
 UNITED STATES             |   1998 | 2728639584.21365
 UNITED STATES             |   1997 | 4680504375.72902
 UNITED STATES             |   1996 | 4690003044.26121
 UNITED STATES             |   1995 | 4667629267.95991
 UNITED STATES             |   1994 | 4702842820.85377
 UNITED STATES             |   1993 | 4675982329.80093
 UNITED STATES             |   1992 | 4683475193.08901
 VIETNAM                   |   1998 |   2750266218.189
 VIETNAM                   |   1997 | 4674608269.66025
 VIETNAM                   |   1996 | 4673707247.87136
 VIETNAM                   |   1995 | 4653351177.30224
 VIETNAM                   |   1994 | 4682779640.32222
 VIETNAM                   |   1993 | 4682761720.75719
 VIETNAM                   |   1992 | 4708166296.82942
(175 rows)

COMMIT;
COMMIT
