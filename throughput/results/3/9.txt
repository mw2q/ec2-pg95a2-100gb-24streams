BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%seashell%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2726750762.65428
 ALGERIA                   |   1997 | 4678201221.30749
 ALGERIA                   |   1996 | 4662075796.09533
 ALGERIA                   |   1995 | 4640960320.83291
 ALGERIA                   |   1994 | 4653885040.56883
 ALGERIA                   |   1993 | 4641675993.19428
 ALGERIA                   |   1992 | 4674329622.42959
 ARGENTINA                 |   1998 | 2719288561.28626
 ARGENTINA                 |   1997 | 4644190099.99853
 ARGENTINA                 |   1996 | 4639065212.69055
 ARGENTINA                 |   1995 | 4630825679.31342
 ARGENTINA                 |   1994 | 4637891878.46013
 ARGENTINA                 |   1993 | 4648704289.59276
 ARGENTINA                 |   1992 |  4633909190.8723
 BRAZIL                    |   1998 | 2755471868.63627
 BRAZIL                    |   1997 | 4692129853.07874
 BRAZIL                    |   1996 | 4692313170.34089
 BRAZIL                    |   1995 | 4694649523.21705
 BRAZIL                    |   1994 | 4677915951.21203
 BRAZIL                    |   1993 |  4697502898.0037
 BRAZIL                    |   1992 | 4666140041.87309
 CANADA                    |   1998 | 2772517794.35181
 CANADA                    |   1997 | 4697469748.88157
 CANADA                    |   1996 | 4741097219.08756
 CANADA                    |   1995 | 4719344669.30341
 CANADA                    |   1994 | 4703099497.82353
 CANADA                    |   1993 | 4690489771.70049
 CANADA                    |   1992 | 4730241573.11683
 CHINA                     |   1998 | 2722366875.33771
 CHINA                     |   1997 | 4675804352.41767
 CHINA                     |   1996 | 4695798471.96927
 CHINA                     |   1995 | 4668907505.62171
 CHINA                     |   1994 | 4666830022.88336
 CHINA                     |   1993 | 4666580202.69115
 CHINA                     |   1992 | 4708535235.87056
 EGYPT                     |   1998 | 2733822321.15229
 EGYPT                     |   1997 |  4667897221.8176
 EGYPT                     |   1996 | 4686054194.59136
 EGYPT                     |   1995 | 4693549699.65209
 EGYPT                     |   1994 | 4675973121.18481
 EGYPT                     |   1993 |  4656626669.7828
 EGYPT                     |   1992 | 4668857435.63497
 ETHIOPIA                  |   1998 | 2754760395.95583
 ETHIOPIA                  |   1997 | 4710491040.71471
 ETHIOPIA                  |   1996 | 4739064294.13171
 ETHIOPIA                  |   1995 | 4696952908.46514
 ETHIOPIA                  |   1994 | 4717057424.91814
 ETHIOPIA                  |   1993 | 4711690881.33787
 ETHIOPIA                  |   1992 | 4711739184.03744
 FRANCE                    |   1998 | 2742315123.85817
 FRANCE                    |   1997 | 4696154696.24572
 FRANCE                    |   1996 | 4717542149.55665
 FRANCE                    |   1995 | 4691820963.88182
 FRANCE                    |   1994 | 4712545413.03477
 FRANCE                    |   1993 | 4710579422.54426
 FRANCE                    |   1992 | 4707417512.29623
 GERMANY                   |   1998 |  2761888340.5086
 GERMANY                   |   1997 | 4691858047.23795
 GERMANY                   |   1996 | 4700640403.32907
 GERMANY                   |   1995 | 4688211203.17009
 GERMANY                   |   1994 | 4705814173.84753
 GERMANY                   |   1993 |  4705799211.1037
 GERMANY                   |   1992 | 4714874225.47708
 INDIA                     |   1998 | 2750388839.67205
 INDIA                     |   1997 | 4683442311.02203
 INDIA                     |   1996 | 4692279179.54772
 INDIA                     |   1995 | 4686993585.93359
 INDIA                     |   1994 | 4672328022.98984
 INDIA                     |   1993 | 4664346237.77404
 INDIA                     |   1992 | 4686312828.98311
 INDONESIA                 |   1998 | 2734626695.37233
 INDONESIA                 |   1997 | 4660536419.21875
 INDONESIA                 |   1996 | 4663286443.24392
 INDONESIA                 |   1995 | 4662661296.68073
 INDONESIA                 |   1994 | 4657859341.05081
 INDONESIA                 |   1993 | 4635106397.51332
 INDONESIA                 |   1992 | 4660476207.18801
 IRAN                      |   1998 | 2722159657.94075
 IRAN                      |   1997 | 4663727572.49952
 IRAN                      |   1996 | 4660807760.34412
 IRAN                      |   1995 | 4659959320.88826
 IRAN                      |   1994 | 4659937413.35547
 IRAN                      |   1993 | 4637816764.08071
 IRAN                      |   1992 | 4647842718.49643
 IRAQ                      |   1998 | 2732199590.12985
 IRAQ                      |   1997 | 4695308799.56871
 IRAQ                      |   1996 | 4668828456.16332
 IRAQ                      |   1995 |  4644912160.7355
 IRAQ                      |   1994 | 4648033280.80485
 IRAQ                      |   1993 | 4657798424.91526
 IRAQ                      |   1992 | 4674348137.30303
 JAPAN                     |   1998 | 2737071438.59856
 JAPAN                     |   1997 | 4659543832.30622
 JAPAN                     |   1996 | 4659973588.00745
 JAPAN                     |   1995 | 4640309807.35855
 JAPAN                     |   1994 | 4685253267.42392
 JAPAN                     |   1993 | 4654684851.99551
 JAPAN                     |   1992 | 4648494563.02937
 JORDAN                    |   1998 | 2722064744.82707
 JORDAN                    |   1997 | 4639147547.61575
 JORDAN                    |   1996 | 4676070861.66892
 JORDAN                    |   1995 | 4653727642.63791
 JORDAN                    |   1994 | 4654038249.36214
 JORDAN                    |   1993 | 4646474467.65191
 JORDAN                    |   1992 | 4631533460.20813
 KENYA                     |   1998 | 2706932978.31231
 KENYA                     |   1997 | 4623601739.89145
 KENYA                     |   1996 | 4634736102.50777
 KENYA                     |   1995 | 4637589088.85571
 KENYA                     |   1994 | 4611765907.75523
 KENYA                     |   1993 | 4630201815.23704
 KENYA                     |   1992 | 4626210658.16918
 MOROCCO                   |   1998 |  2758118606.1401
 MOROCCO                   |   1997 | 4728196264.00465
 MOROCCO                   |   1996 | 4717984708.19387
 MOROCCO                   |   1995 | 4722809626.31382
 MOROCCO                   |   1994 | 4713182504.13686
 MOROCCO                   |   1993 | 4718118646.79839
 MOROCCO                   |   1992 | 4710403503.88855
 MOZAMBIQUE                |   1998 | 2732447015.19569
 MOZAMBIQUE                |   1997 | 4678277018.67969
 MOZAMBIQUE                |   1996 | 4680960188.41457
 MOZAMBIQUE                |   1995 | 4654248054.54249
 MOZAMBIQUE                |   1994 | 4654140778.39357
 MOZAMBIQUE                |   1993 | 4680618192.76606
 MOZAMBIQUE                |   1992 | 4700916544.88234
 PERU                      |   1998 | 2716824065.97152
 PERU                      |   1997 | 4645194663.68141
 PERU                      |   1996 | 4645731376.86221
 PERU                      |   1995 | 4618002682.16914
 PERU                      |   1994 | 4624564049.18183
 PERU                      |   1993 | 4612828583.65945
 PERU                      |   1992 | 4650010707.59696
 ROMANIA                   |   1998 | 2762508688.61327
 ROMANIA                   |   1997 | 4685646839.03681
 ROMANIA                   |   1996 | 4721791532.34476
 ROMANIA                   |   1995 | 4683154593.99416
 ROMANIA                   |   1994 | 4712522945.98442
 ROMANIA                   |   1993 | 4693548923.69187
 ROMANIA                   |   1992 | 4717397236.26995
 RUSSIA                    |   1998 | 2700616471.76669
 RUSSIA                    |   1997 | 4628771592.10694
 RUSSIA                    |   1996 | 4660571135.15463
 RUSSIA                    |   1995 | 4632338618.22489
 RUSSIA                    |   1994 | 4649304600.87032
 RUSSIA                    |   1993 | 4634491418.07021
 RUSSIA                    |   1992 | 4639054103.68724
 SAUDI ARABIA              |   1998 | 2751576799.08372
 SAUDI ARABIA              |   1997 | 4682611523.03526
 SAUDI ARABIA              |   1996 | 4681039690.63515
 SAUDI ARABIA              |   1995 | 4684418637.88262
 SAUDI ARABIA              |   1994 | 4712227811.40425
 SAUDI ARABIA              |   1993 | 4678296868.91421
 SAUDI ARABIA              |   1992 | 4712171916.42402
 UNITED KINGDOM            |   1998 | 2762202402.65287
 UNITED KINGDOM            |   1997 | 4708780911.95738
 UNITED KINGDOM            |   1996 | 4728962095.58729
 UNITED KINGDOM            |   1995 | 4678571246.41419
 UNITED KINGDOM            |   1994 | 4727451588.85525
 UNITED KINGDOM            |   1993 | 4702579784.73164
 UNITED KINGDOM            |   1992 | 4699782907.30168
 UNITED STATES             |   1998 | 2729689832.07925
 UNITED STATES             |   1997 | 4686364531.64202
 UNITED STATES             |   1996 | 4677985759.67689
 UNITED STATES             |   1995 | 4648852384.40021
 UNITED STATES             |   1994 | 4679095742.94184
 UNITED STATES             |   1993 | 4681395422.43423
 UNITED STATES             |   1992 | 4687772890.11851
 VIETNAM                   |   1998 | 2750501850.97556
 VIETNAM                   |   1997 | 4681098120.37878
 VIETNAM                   |   1996 | 4707225997.19028
 VIETNAM                   |   1995 | 4672041966.93526
 VIETNAM                   |   1994 | 4693485308.28893
 VIETNAM                   |   1993 | 4694382266.66523
 VIETNAM                   |   1992 | 4709684415.60001
(175 rows)

COMMIT;
COMMIT
