BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%steel%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2737903107.98617
 ALGERIA                   |   1997 | 4685985246.41638
 ALGERIA                   |   1996 | 4689403356.50634
 ALGERIA                   |   1995 |  4708075241.9692
 ALGERIA                   |   1994 | 4706241065.24112
 ALGERIA                   |   1993 |  4678962100.4489
 ALGERIA                   |   1992 | 4690935465.59499
 ARGENTINA                 |   1998 | 2727709850.76867
 ARGENTINA                 |   1997 | 4649172144.58831
 ARGENTINA                 |   1996 | 4681761943.53762
 ARGENTINA                 |   1995 | 4651221616.36997
 ARGENTINA                 |   1994 | 4660286455.52982
 ARGENTINA                 |   1993 | 4671962896.22444
 ARGENTINA                 |   1992 | 4659766685.14312
 BRAZIL                    |   1998 | 2733198028.43659
 BRAZIL                    |   1997 | 4684434264.66545
 BRAZIL                    |   1996 | 4703456201.64431
 BRAZIL                    |   1995 | 4683578661.32617
 BRAZIL                    |   1994 |  4691296294.3981
 BRAZIL                    |   1993 | 4692816364.17285
 BRAZIL                    |   1992 | 4684524800.22661
 CANADA                    |   1998 | 2732168883.78998
 CANADA                    |   1997 | 4670484979.83629
 CANADA                    |   1996 |   4674366126.285
 CANADA                    |   1995 | 4684735328.02662
 CANADA                    |   1994 | 4667348247.91888
 CANADA                    |   1993 | 4684557522.40389
 CANADA                    |   1992 | 4689187240.68397
 CHINA                     |   1998 |  2736462778.0606
 CHINA                     |   1997 | 4663074422.92714
 CHINA                     |   1996 | 4712579964.65253
 CHINA                     |   1995 |  4660357837.7594
 CHINA                     |   1994 | 4685338790.37708
 CHINA                     |   1993 |  4663303237.9048
 CHINA                     |   1992 | 4671697227.28431
 EGYPT                     |   1998 | 2737173900.27666
 EGYPT                     |   1997 | 4683925603.71801
 EGYPT                     |   1996 | 4690292855.31784
 EGYPT                     |   1995 | 4670788441.95663
 EGYPT                     |   1994 | 4667968118.43812
 EGYPT                     |   1993 | 4682615537.12632
 EGYPT                     |   1992 | 4699046877.63619
 ETHIOPIA                  |   1998 | 2773550160.86248
 ETHIOPIA                  |   1997 | 4724662139.88669
 ETHIOPIA                  |   1996 | 4725065749.61128
 ETHIOPIA                  |   1995 | 4708630716.03772
 ETHIOPIA                  |   1994 | 4721473844.20754
 ETHIOPIA                  |   1993 | 4722960339.80751
 ETHIOPIA                  |   1992 | 4757247301.97615
 FRANCE                    |   1998 | 2759798156.15924
 FRANCE                    |   1997 | 4695270167.56045
 FRANCE                    |   1996 | 4712277977.04274
 FRANCE                    |   1995 | 4706723703.13862
 FRANCE                    |   1994 | 4675681684.66333
 FRANCE                    |   1993 | 4704957820.88015
 FRANCE                    |   1992 | 4716995690.30488
 GERMANY                   |   1998 | 2785001004.01458
 GERMANY                   |   1997 | 4692948626.65002
 GERMANY                   |   1996 | 4723937221.63893
 GERMANY                   |   1995 | 4721057530.72314
 GERMANY                   |   1994 | 4712967833.12414
 GERMANY                   |   1993 | 4731732937.35596
 GERMANY                   |   1992 | 4719091352.69319
 INDIA                     |   1998 | 2733118835.46574
 INDIA                     |   1997 |  4680327126.3283
 INDIA                     |   1996 |  4662612406.5441
 INDIA                     |   1995 | 4681494058.77701
 INDIA                     |   1994 | 4672390187.06711
 INDIA                     |   1993 | 4674190527.04629
 INDIA                     |   1992 | 4676600474.34978
 INDONESIA                 |   1998 | 2711950862.52241
 INDONESIA                 |   1997 | 4626451144.01358
 INDONESIA                 |   1996 | 4658350147.02568
 INDONESIA                 |   1995 | 4658261858.09424
 INDONESIA                 |   1994 | 4655548311.59422
 INDONESIA                 |   1993 | 4662834023.78419
 INDONESIA                 |   1992 | 4662712471.80363
 IRAN                      |   1998 | 2728278472.51233
 IRAN                      |   1997 | 4649816189.90391
 IRAN                      |   1996 | 4653770251.22128
 IRAN                      |   1995 | 4636183679.43539
 IRAN                      |   1994 | 4642297875.89123
 IRAN                      |   1993 | 4637311180.51047
 IRAN                      |   1992 | 4668488173.08091
 IRAQ                      |   1998 | 2711645425.71438
 IRAQ                      |   1997 | 4665885012.15635
 IRAQ                      |   1996 | 4668961612.14283
 IRAQ                      |   1995 | 4639817663.92185
 IRAQ                      |   1994 |  4656635920.1091
 IRAQ                      |   1993 | 4638067008.69465
 IRAQ                      |   1992 | 4676596141.22424
 JAPAN                     |   1998 | 2723080951.84938
 JAPAN                     |   1997 |  4630056780.7087
 JAPAN                     |   1996 | 4646043880.74344
 JAPAN                     |   1995 | 4662889024.40699
 JAPAN                     |   1994 | 4630303909.15963
 JAPAN                     |   1993 | 4625648527.18322
 JAPAN                     |   1992 | 4657106005.41858
 JORDAN                    |   1998 | 2711056653.09619
 JORDAN                    |   1997 | 4628463131.88192
 JORDAN                    |   1996 | 4672753252.03402
 JORDAN                    |   1995 |  4647525869.6728
 JORDAN                    |   1994 | 4661772600.40606
 JORDAN                    |   1993 | 4643335222.15907
 JORDAN                    |   1992 | 4673283772.99397
 KENYA                     |   1998 | 2726286742.58004
 KENYA                     |   1997 | 4639795993.72429
 KENYA                     |   1996 | 4648346071.45138
 KENYA                     |   1995 |   4640487696.631
 KENYA                     |   1994 | 4645512332.99157
 KENYA                     |   1993 | 4628633415.20212
 KENYA                     |   1992 |  4662423699.6173
 MOROCCO                   |   1998 | 2731211368.53538
 MOROCCO                   |   1997 | 4676272862.17585
 MOROCCO                   |   1996 | 4687164811.12597
 MOROCCO                   |   1995 | 4669457535.64801
 MOROCCO                   |   1994 | 4675764289.81059
 MOROCCO                   |   1993 | 4671052768.41348
 MOROCCO                   |   1992 | 4699911324.43098
 MOZAMBIQUE                |   1998 | 2745385969.76898
 MOZAMBIQUE                |   1997 | 4693035168.19174
 MOZAMBIQUE                |   1996 | 4669397359.10259
 MOZAMBIQUE                |   1995 | 4656492040.02079
 MOZAMBIQUE                |   1994 | 4673226542.21767
 MOZAMBIQUE                |   1993 | 4635743499.00179
 MOZAMBIQUE                |   1992 | 4662003993.60281
 PERU                      |   1998 |  2715683866.5476
 PERU                      |   1997 | 4630714399.52263
 PERU                      |   1996 |  4650013819.0171
 PERU                      |   1995 |  4617595410.5035
 PERU                      |   1994 | 4634786624.28467
 PERU                      |   1993 | 4637966520.49703
 PERU                      |   1992 | 4651221507.32573
 ROMANIA                   |   1998 | 2766105013.43843
 ROMANIA                   |   1997 | 4676963632.67459
 ROMANIA                   |   1996 | 4704478738.13589
 ROMANIA                   |   1995 | 4676082207.67793
 ROMANIA                   |   1994 | 4678484160.94339
 ROMANIA                   |   1993 | 4679666077.25274
 ROMANIA                   |   1992 | 4711118643.57262
 RUSSIA                    |   1998 | 2723592545.45784
 RUSSIA                    |   1997 | 4672683848.84634
 RUSSIA                    |   1996 | 4685279200.42332
 RUSSIA                    |   1995 | 4648042803.96114
 RUSSIA                    |   1994 |  4672421822.2521
 RUSSIA                    |   1993 | 4657339884.93604
 RUSSIA                    |   1992 | 4663137346.30816
 SAUDI ARABIA              |   1998 | 2720736914.36276
 SAUDI ARABIA              |   1997 | 4653109735.03076
 SAUDI ARABIA              |   1996 | 4666115350.98614
 SAUDI ARABIA              |   1995 | 4674293926.60802
 SAUDI ARABIA              |   1994 | 4663583713.80742
 SAUDI ARABIA              |   1993 |  4664383150.8516
 SAUDI ARABIA              |   1992 | 4683199273.46745
 UNITED KINGDOM            |   1998 | 2768544980.47604
 UNITED KINGDOM            |   1997 | 4692863128.33163
 UNITED KINGDOM            |   1996 | 4729703748.08724
 UNITED KINGDOM            |   1995 |  4712218864.7203
 UNITED KINGDOM            |   1994 | 4735142641.62754
 UNITED KINGDOM            |   1993 | 4713287164.28256
 UNITED KINGDOM            |   1992 | 4719814013.24248
 UNITED STATES             |   1998 | 2724128232.54856
 UNITED STATES             |   1997 | 4665684741.91001
 UNITED STATES             |   1996 |  4682802032.2063
 UNITED STATES             |   1995 | 4654385214.62575
 UNITED STATES             |   1994 | 4685228810.82272
 UNITED STATES             |   1993 | 4678264009.70105
 UNITED STATES             |   1992 | 4671537363.08036
 VIETNAM                   |   1998 | 2727315468.17738
 VIETNAM                   |   1997 | 4726061987.85135
 VIETNAM                   |   1996 | 4710712004.22838
 VIETNAM                   |   1995 | 4711050186.72319
 VIETNAM                   |   1994 | 4695361894.85709
 VIETNAM                   |   1993 | 4709537950.94423
 VIETNAM                   |   1992 | 4696335144.78867
(175 rows)

COMMIT;
COMMIT
